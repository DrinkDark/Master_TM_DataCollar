@startuml
skinparam Monochrome true

participant "Main Thread" as Main
participant "Recorder" as Rec
participant "Proximity" as Prox
participant "SD Card" as FS

== Operational Loop ==

loop Forever
    Main -> Main : k_poll(events, K_FOREVER)
    
    alt reset_sem is given
         -> Main : Event[0]: reset_sem
        activate Main
        Main -> Prox : Disable proximity detection
        Main -> Rec : Disable recording
        Main -> FS : sdcard_off_and_reset()
        deactivate Main
    end

    alt low_energy_mode_sem is given
         -> Main : Event[1]: low_energy_mode_sem
        activate Main
        Main -> Main : must_be_in_power_saving_mode = true
        Main -> Prox : ble_disable_proximity_detection()
        Main -> Rec : recorder_disable_record_saving()
        Main -> Rec : recorder_disable_record()
        Main -> Main : system_reset()
        deactivate Main
    end
end
@enduml