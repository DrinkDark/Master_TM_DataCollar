@startuml
skinparam monochrome true
skinparam shadowing false
skinparam packageStyle rectangle

box "Producer Thread" #f9f9f9
    participant "Audio Recorder\n(I2S)" as Rec
end box

box "Shared RAM" #white
    database "Buffer 0" as B0
    database "Buffer 1" as B1
end box

box "Consumer Thread" #f9f9f9
    participant "File Store\n(FATFS)" as Store
end box

participant "SD Card" as SD

== Cycle A: Fill B0 / Write B1 ==
group Concurrent Operations
    Rec -> B0 : Fill with data
    Store -> B1 : Read data
    Store -> SD : Write
end

== Cycle B: Buffer Swap ==
Rec -> Store : Give semaphore 
note over B0, B1 : Buffers Swap Roles

== Cycle C: Fill B1 / Write B0 ==
group Concurrent Operations
    Rec -> B1 : Fill with data
    Store -> B0 : Read data
    Store -> SD : Write
end

@enduml