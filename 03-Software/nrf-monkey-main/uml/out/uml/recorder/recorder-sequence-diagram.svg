<?plantuml 1.2026.1beta5?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1418px" preserveAspectRatio="none" style="width:1210px;height:1418px;background:#FFFFFF;" version="1.1" viewBox="0 0 1210 1418" width="1210px" zoomAndPan="magnify"><defs/><g><rect fill="#F9F9F9" height="1406.7734" style="stroke:#181818;stroke-width:0.5;" width="559.1304" x="46" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="165.5596" x="242.7854" y="18.0669">I2S Acquisition Thread</text><rect fill="#F4F4F4" height="1406.7734" style="stroke:#181818;stroke-width:0.5;" width="390.1816" x="627.1304" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="113.769" x="765.3367" y="18.0669">Storage Thread</text><g><title>recorder_thread_i2s</title><rect fill="#FFFFFF" height="1044.1172" style="stroke:#181818;stroke-width:1;" width="10" x="141.9658" y="324.3594"/></g><rect fill="none" height="902.7188" style="stroke:#000000;stroke-width:1.5;" width="1183.1372" x="10" y="458.7578"/><rect fill="none" height="492.9922" style="stroke:#000000;stroke-width:1.5;" width="1140.4546" x="20" y="576.2891"/><rect fill="none" height="283.1953" style="stroke:#000000;stroke-width:1.5;" width="1120.4546" x="30" y="629.5547"/><rect fill="none" height="109.5313" style="stroke:#000000;stroke-width:1.5;" width="1100.4546" x="40" y="796.2188"/><rect fill="none" height="228.0625" style="stroke:#000000;stroke-width:1.5;" width="1153.1372" x="30" y="1126.4141"/><rect fill="none" height="67.3984" style="stroke:#000000;stroke-width:1.5;" width="1095.4136" x="40" y="1280.0781"/><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="I2S" id="part1-lifeline"><g><title>recorder_thread_i2s</title><rect fill="#000000" fill-opacity="0.00000" height="1322.0469" width="8" x="142.9658" y="56.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="146" x2="146" y1="56.4297" y2="1378.4766"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="HW" id="part2-lifeline"><g><title>I2S Hardware</title><rect fill="#000000" fill-opacity="0.00000" height="1322.0469" width="8" x="522.8701" y="56.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="526.6099" x2="526.6099" y1="56.4297" y2="1378.4766"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="Store" id="part3-lifeline"><g><title>recorder_thread_store_to_file</title><rect fill="#000000" fill-opacity="0.00000" height="1322.0469" width="8" x="756.5977" y="56.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="760.1304" x2="760.1304" y1="56.4297" y2="1378.4766"/></g></g><g class="participant-lifeline" data-entity-uid="part4" data-qualified-name="SD" id="part4-lifeline"><g><title>sdcard.c</title><rect fill="#000000" fill-opacity="0.00000" height="1322.0469" width="8" x="952.6885" y="56.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="956.0649" x2="956.0649" y1="56.4297" y2="1378.4766"/></g></g><g class="participant-lifeline" data-entity-uid="part5" data-qualified-name="BLE" id="part5-lifeline"><g><title>BLE Handler</title><rect fill="#000000" fill-opacity="0.00000" height="1322.0469" width="8" x="1099.2246" y="56.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1102.312" x2="1102.312" y1="56.4297" y2="1378.4766"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="I2S" id="part1-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153.9316" x="70" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139.9316" x="77" y="45.1279">recorder_thread_i2s</text></g><g class="participant participant-tail" data-entity-uid="part1" data-qualified-name="I2S" id="part1-tail"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153.9316" x="70" y="1377.4766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139.9316" x="77" y="1397.4717">recorder_thread_i2s</text></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="HW" id="part2-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108.5205" x="472.6099" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.5205" x="479.6099" y="45.1279">I2S Hardware</text></g><g class="participant participant-tail" data-entity-uid="part2" data-qualified-name="HW" id="part2-tail"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108.5205" x="472.6099" y="1377.4766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.5205" x="479.6099" y="1397.4717">I2S Hardware</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="Store" id="part3-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="218.9346" x="651.1304" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="204.9346" x="658.1304" y="45.1279">recorder_thread_store_to_file</text></g><g class="participant participant-tail" data-entity-uid="part3" data-qualified-name="Store" id="part3-tail"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="218.9346" x="651.1304" y="1377.4766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="204.9346" x="658.1304" y="1397.4717">recorder_thread_store_to_file</text></g><g class="participant participant-head" data-entity-uid="part4" data-qualified-name="SD" id="part4-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73.2471" x="920.0649" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.2471" x="927.0649" y="45.1279">sdcard.c</text></g><g class="participant participant-tail" data-entity-uid="part4" data-qualified-name="SD" id="part4-tail"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73.2471" x="920.0649" y="1377.4766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.2471" x="927.0649" y="1397.4717">sdcard.c</text></g><g class="participant participant-head" data-entity-uid="part5" data-qualified-name="BLE" id="part5-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99.8252" x="1053.312" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85.8252" x="1060.312" y="45.1279">BLE Handler</text></g><g class="participant participant-tail" data-entity-uid="part5" data-qualified-name="BLE" id="part5-tail"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99.8252" x="1053.312" y="1377.4766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85.8252" x="1060.312" y="1397.4717">BLE Handler</text></g><g><title>recorder_thread_i2s</title><rect fill="#FFFFFF" height="1044.1172" style="stroke:#181818;stroke-width:1;" width="10" x="141.9658" y="324.3594"/></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1203.1372" x="0" y="86.9961"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="86.9961" y2="86.9961"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="89.9961" y2="89.9961"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="110.624" x="546.2566" y="76.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="92.0981" x="552.2566" y="92.4966">Initialization</text><g class="message" data-entity-1="part1" data-entity-2="part4" id="msg1"><polygon fill="#181818" points="944.6885,126.6953,954.6885,130.6953,944.6885,134.6953,948.6885,130.6953" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="146.9658" x2="950.6885" y1="130.6953" y2="130.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107.2373" x="153.9658" y="125.6294">sdcard_file_init()</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg2"><line style="stroke:#181818;stroke-width:1;" x1="146.9658" x2="188.9658" y1="159.8281" y2="159.8281"/><line style="stroke:#181818;stroke-width:1;" x1="188.9658" x2="188.9658" y1="159.8281" y2="172.8281"/><line style="stroke:#181818;stroke-width:1;" x1="147.9658" x2="188.9658" y1="172.8281" y2="172.8281"/><polygon fill="#181818" points="157.9658,168.8281,147.9658,172.8281,157.9658,176.8281,153.9658,172.8281" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151.3662" x="153.9658" y="154.7622">recorder_i2s_initialize()</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg3"><line style="stroke:#181818;stroke-width:1;" x1="146.9658" x2="188.9658" y1="201.9609" y2="201.9609"/><line style="stroke:#181818;stroke-width:1;" x1="188.9658" x2="188.9658" y1="201.9609" y2="214.9609"/><line style="stroke:#181818;stroke-width:1;" x1="147.9658" x2="188.9658" y1="214.9609" y2="214.9609"/><polygon fill="#181818" points="157.9658,210.9609,147.9658,214.9609,157.9658,218.9609,153.9658,214.9609" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.5054" x="153.9658" y="196.895">recorder_configure_streams()</text></g><g class="message" data-entity-1="part1" data-entity-2="part5" id="msg4"><polygon fill="#181818" points="1091.2246,240.0938,1101.2246,244.0938,1091.2246,248.0938,1095.2246,244.0938" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="146.9658" x2="1097.2246" y1="244.0938" y2="244.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180.7495" x="153.9658" y="239.0278">ble_update_status(ST_IDLE)</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1203.1372" x="0" y="272.6602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="272.6602" y2="272.6602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="275.6602" y2="275.6602"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="275.8091" x="463.6641" y="262.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="257.2832" x="469.6641" y="278.1606">Phase 1: Wait for recording trigger</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg5"><line style="stroke:#181818;stroke-width:1;" x1="146.9658" x2="193.9658" y1="311.3594" y2="311.3594"/><line style="stroke:#181818;stroke-width:1;" x1="193.9658" x2="193.9658" y1="311.3594" y2="324.3594"/><line style="stroke:#181818;stroke-width:1;" x1="152.9658" x2="193.9658" y1="324.3594" y2="324.3594"/><polygon fill="#181818" points="162.9658,320.3594,152.9658,324.3594,162.9658,328.3594,158.9658,324.3594" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="365.9043" x="158.9658" y="306.2935">k_sem_take(recorder_toggle_transfer_sem, K_FOREVER)</text></g><path d="M535.9043,303.7266 L535.9043,328.7266 L732.9043,328.7266 L732.9043,313.7266 L722.9043,303.7266 L535.9043,303.7266" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M722.9043,303.7266 L722.9043,313.7266 L732.9043,313.7266 L722.9043,303.7266" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176.0205" x="541.9043" y="320.7935">Triggered by button or BLE</text><g class="message" data-entity-1="part1" data-entity-2="part5" id="msg7"><polygon fill="#181818" points="1091.2246,354.4922,1101.2246,358.4922,1091.2246,362.4922,1095.2246,358.4922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="1097.2246" y1="358.4922" y2="358.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230.6802" x="158.9658" y="353.4263">ble_update_status(ST_RECORDING)</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1203.1372" x="0" y="387.0586"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="387.0586" y2="387.0586"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="390.0586" y2="390.0586"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="296.3945" x="453.3713" y="376.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="277.8687" x="459.3713" y="392.5591">Phase 2: Calibration &amp; wait for saving</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg8"><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="193.9658" y1="430.7578" y2="430.7578"/><line style="stroke:#181818;stroke-width:1;" x1="193.9658" x2="193.9658" y1="430.7578" y2="443.7578"/><line style="stroke:#181818;stroke-width:1;" x1="152.9658" x2="193.9658" y1="443.7578" y2="443.7578"/><polygon fill="#181818" points="162.9658,439.7578,152.9658,443.7578,162.9658,447.7578,158.9658,443.7578" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.8291" x="158.9658" y="425.6919">recorder_calibration()</text></g><path d="M10,458.7578 L86.624,458.7578 L86.624,465.8906 L76.624,475.8906 L10,475.8906 L10,458.7578" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="902.7188" style="stroke:#000000;stroke-width:1.5;" width="1183.1372" x="10" y="458.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31.624" x="25" y="471.8247">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="163.1631" x="101.624" y="470.9683">[while is_recorder_enable]</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg9"><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="193.9658" y1="501.0898" y2="501.0898"/><line style="stroke:#181818;stroke-width:1;" x1="193.9658" x2="193.9658" y1="501.0898" y2="514.0898"/><line style="stroke:#181818;stroke-width:1;" x1="152.9658" x2="193.9658" y1="514.0898" y2="514.0898"/><polygon fill="#181818" points="162.9658,510.0898,152.9658,514.0898,162.9658,518.0898,158.9658,514.0898" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202.7759" x="158.9658" y="496.0239">k_poll(rec_events, K_FOREVER)</text></g><path d="M382.7759,480.8906 L382.7759,520.8906 L679.7759,520.8906 L679.7759,490.8906 L669.7759,480.8906 L382.7759,480.8906" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M669.7759,480.8906 L669.7759,490.8906 L679.7759,490.8906 L669.7759,480.8906" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="276.3643" x="388.7759" y="497.9575">Poll toggle saving and transfer semaphore</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152.9341" x="388.7759" y="513.0903">CPU sleeps until trigger</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1203.1372" x="0" y="546.7227"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="546.7227" y2="546.7227"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="549.7227" y2="549.7227"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="306.1128" x="448.5122" y="536.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="287.5869" x="454.5122" y="552.2231">Phase 3: Data acquisition (saving loop)</text><path d="M20,576.2891 L84.4429,576.2891 L84.4429,583.4219 L74.4429,593.4219 L20,593.4219 L20,576.2891" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="492.9922" style="stroke:#000000;stroke-width:1.5;" width="1140.4546" x="20" y="576.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="35" y="589.356">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="152.9204" x="99.4429" y="588.4995">[Toggle saving signaled]</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg11"><polygon fill="#181818" points="514.8701,610.5547,524.8701,614.5547,514.8701,618.5547,518.8701,614.5547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="520.8701" y1="614.5547" y2="614.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212.8179" x="158.9658" y="609.4888">i2s_trigger(I2S_TRIGGER_START)</text></g><path d="M30,629.5547 L106.624,629.5547 L106.624,636.6875 L96.624,646.6875 L30,646.6875 L30,629.5547" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="283.1953" style="stroke:#000000;stroke-width:1.5;" width="1120.4546" x="30" y="629.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31.624" x="45" y="642.6216">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="319.8809" x="121.624" y="641.7651">[while is_saving_enable AND !force_stop_recording]</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg12"><polygon fill="#181818" points="514.8701,663.8203,524.8701,667.8203,514.8701,671.8203,518.8701,667.8203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="520.8701" y1="667.8203" y2="667.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139.1787" x="158.9658" y="662.7544">i2s_read(mem_block)</text></g><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg13"><polygon fill="#181818" points="162.9658,692.9531,152.9658,696.9531,162.9658,700.9531,158.9658,696.9531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="156.9658" x2="525.8701" y1="696.9531" y2="696.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.5918" x="168.9658" y="691.8872">Audio Data (24-bit)</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg14"><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="193.9658" y1="726.0859" y2="726.0859"/><line style="stroke:#181818;stroke-width:1;" x1="193.9658" x2="193.9658" y1="726.0859" y2="739.0859"/><line style="stroke:#181818;stroke-width:1;" x1="152.9658" x2="193.9658" y1="739.0859" y2="739.0859"/><polygon fill="#181818" points="162.9658,735.0859,152.9658,739.0859,162.9658,743.0859,158.9658,739.0859" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190.0044" x="158.9658" y="721.02">recorder_normalize_sample()</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg15"><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="193.9658" y1="768.2188" y2="768.2188"/><line style="stroke:#181818;stroke-width:1;" x1="193.9658" x2="193.9658" y1="768.2188" y2="781.2188"/><line style="stroke:#181818;stroke-width:1;" x1="152.9658" x2="193.9658" y1="781.2188" y2="781.2188"/><polygon fill="#181818" points="162.9658,777.2188,152.9658,781.2188,162.9658,785.2188,158.9658,781.2188" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197.3359" x="158.9658" y="763.1528">Copy to store_block[write_idx]</text></g><path d="M40,796.2188 L104.4429,796.2188 L104.4429,803.3516 L94.4429,813.3516 L40,813.3516 L40,796.2188" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="109.5313" style="stroke:#000000;stroke-width:1.5;" width="1100.4546" x="40" y="796.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="55" y="809.2856">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="118.9751" x="119.4429" y="808.4292">[store_block is full]</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg16"><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="193.9658" y1="834.4844" y2="834.4844"/><line style="stroke:#181818;stroke-width:1;" x1="193.9658" x2="193.9658" y1="834.4844" y2="847.4844"/><line style="stroke:#181818;stroke-width:1;" x1="152.9658" x2="193.9658" y1="847.4844" y2="847.4844"/><polygon fill="#181818" points="162.9658,843.4844,152.9658,847.4844,162.9658,851.4844,158.9658,847.4844" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85.6616" x="158.9658" y="829.4185">Swap Buffers</text></g><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg17"><polygon fill="#181818" points="748.5977,883.1836,758.5977,887.1836,748.5977,891.1836,752.5977,887.1836" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="754.5977" y1="887.1836" y2="887.1836"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251.583" x="158.9658" y="882.1177">k_sem_give(recorder_file_access_sem)</text></g><path d="M765,860.4844 L765,900.4844 L1124,900.4844 L1124,870.4844 L1114,860.4844 L765,860.4844" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M1114,860.4844 L1114,870.4844 L1124,870.4844 L1114,860.4844" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="338.8569" x="771" y="877.5513">This interaction is detailed in the sequence diagram</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294.2139" x="771" y="892.6841">recorder-file-saving-sequence-diagram.puml.</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1203.1372" x="0" y="940.3164"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="940.3164" y2="940.3164"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="943.3164" y2="943.3164"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="270.001" x="466.5681" y="929.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="251.4751" x="472.5681" y="945.8169">Stop saving / back to record mode</text><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg19"><polygon fill="#181818" points="748.5977,983.0156,758.5977,987.0156,748.5977,991.0156,752.5977,987.0156" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="754.5977" y1="987.0156" y2="987.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251.583" x="158.9658" y="981.9497">k_sem_give(recorder_file_access_sem)</text></g><path d="M765,967.8828 L765,992.8828 L963,992.8828 L963,977.8828 L953,967.8828 L765,967.8828" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M953,967.8828 L953,977.8828 L963,977.8828 L953,967.8828" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177.3916" x="771" y="984.9497">Flush remaining data to SD</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg21"><polygon fill="#181818" points="514.8701,1015.1484,524.8701,1019.1484,514.8701,1023.1484,518.8701,1019.1484" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="520.8701" y1="1019.1484" y2="1019.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207.873" x="158.9658" y="1014.0825">i2s_trigger(I2S_TRIGGER_DROP)</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg22"><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="193.9658" y1="1048.2813" y2="1048.2813"/><line style="stroke:#181818;stroke-width:1;" x1="193.9658" x2="193.9658" y1="1048.2813" y2="1061.2813"/><line style="stroke:#181818;stroke-width:1;" x1="152.9658" x2="193.9658" y1="1061.2813" y2="1061.2813"/><polygon fill="#181818" points="162.9658,1057.2813,152.9658,1061.2813,162.9658,1065.2813,158.9658,1061.2813" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.4736" x="158.9658" y="1043.2153">gpio_hal_force_low_i2s_gpio()</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1203.1372" x="0" y="1096.8477"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="1096.8477" y2="1096.8477"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="1099.8477" y2="1099.8477"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="174.9131" x="514.1121" y="1086.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="156.3872" x="520.1121" y="1102.3481">Phase 4: Termination</text><path d="M30,1126.4141 L94.4429,1126.4141 L94.4429,1133.5469 L84.4429,1143.5469 L30,1143.5469 L30,1126.4141" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="228.0625" style="stroke:#000000;stroke-width:1.5;" width="1153.1372" x="30" y="1126.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="45" y="1139.481">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="162.4595" x="109.4429" y="1138.6245">[Toggle transfer signaled]</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg23"><polygon fill="#181818" points="514.8701,1160.6797,524.8701,1164.6797,514.8701,1168.6797,518.8701,1164.6797" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="520.8701" y1="1164.6797" y2="1164.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207.873" x="158.9658" y="1159.6138">i2s_trigger(I2S_TRIGGER_DROP)</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg24"><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="193.9658" y1="1193.8125" y2="1193.8125"/><line style="stroke:#181818;stroke-width:1;" x1="193.9658" x2="193.9658" y1="1193.8125" y2="1206.8125"/><line style="stroke:#181818;stroke-width:1;" x1="152.9658" x2="193.9658" y1="1206.8125" y2="1206.8125"/><polygon fill="#181818" points="162.9658,1202.8125,152.9658,1206.8125,162.9658,1210.8125,158.9658,1206.8125" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.4736" x="158.9658" y="1188.7466">gpio_hal_force_low_i2s_gpio()</text></g><g class="message" data-entity-1="part1" data-entity-2="part5" id="msg25"><polygon fill="#181818" points="1091.2246,1231.9453,1101.2246,1235.9453,1091.2246,1239.9453,1095.2246,1235.9453" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="1097.2246" y1="1235.9453" y2="1235.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180.7495" x="158.9658" y="1230.8794">ble_update_status(ST_IDLE)</text></g><g class="message" data-entity-1="part1" data-entity-2="part4" id="msg26"><polygon fill="#181818" points="944.6885,1261.0781,954.6885,1265.0781,944.6885,1269.0781,948.6885,1265.0781" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="950.6885" y1="1265.0781" y2="1265.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.1611" x="158.9658" y="1260.0122">sdcard_file_close()</text></g><path d="M40,1280.0781 L104.4429,1280.0781 L104.4429,1287.2109 L94.4429,1297.2109 L40,1297.2109 L40,1280.0781" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="67.3984" style="stroke:#000000;stroke-width:1.5;" width="1095.4136" x="40" y="1280.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="55" y="1293.145">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="220.5962" x="119.4429" y="1292.2886">[No open collar command received]</text><g class="message" data-entity-1="part1" data-entity-2="part4" id="msg27"><polygon fill="#181818" points="944.6885,1324.9102,954.6885,1328.9102,944.6885,1332.9102,948.6885,1328.9102" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="950.6885" y1="1328.9102" y2="1328.9102"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.1543" x="158.9658" y="1323.8442">sdcard_off_and_reset()</text></g><path d="M961,1302.2109 L961,1342.2109 L1119,1342.2109 L1119,1312.2109 L1109,1302.2109 L961,1302.2109" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M1109,1302.2109 L1109,1312.2109 L1119,1312.2109 L1109,1302.2109" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.1953" x="967" y="1319.2778">Back in Hardware off</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133.5928" x="971.1323" y="1334.4106">apply software reset</text><?plantuml-src fLRRRkCs47tNLqnJeB21Ejrryr83AP34Jc9qDp5ijtbe2c4iKX8HYjIIL9pqwpkaB5bod2wwjU7emiCvCsSkZ7qIgaI31NpMIYUvqGK7PoeUsNPbWSQ9H9Iet08P4og3yOVE-gL-QTv__1156_q29_Fn2YwIBvMmmWcjO9qRZkm4lh_-nN-ZScyJJWnFj67Sn2wWOZ6s9u0Mo4WVwAtUec5RD3mWRXyYhXWGvOvtvRJ1Z7Vuplptt_aiRUAnqt4gP6tNc-7zJPObn7oQrElJFMyFTVbfHXug9ha9G7gEelDpc2lI0QNu6uCSv-THv8CP_KgcO0AryS0V2u8EXisolqoWzPYa2O1WYxyBIxHAHLPHLDPHY8NT8xs74zWGKLKoT1w1hhA3rJgUJp_DXi7THOwMmyS9FA1ma6gpC-rpx8p8CcwwCTJiJx7bHUpmYG_s2kii8ofdKDcKdWdn8_mMNzylPt_CbiD8QSU13EPk0klQC2TTNs5JEKT24REN41CddidPK19V3sGvkxfVJkTtDzrenXEu8jKsfax13x1jOhFux0Dx4z1Uplq-4ZAIMfUmpIbP86pSehX2yYO2-XpeKceflIOnV-RAsPu27jvLOK5Og6Lh7ADwWaP180MnpAay7zNLudUmalFIGgMSa4rgWitmfmt-vmbCqI5WfoS7E_C-dA6Ftkz0wM3TOxSYKoWv2ykTu6uVA3PVZplM0RsFrylvpSri6Q_M5ylriDtItlIbgnbsmi75tHI-etmaFfMwZDkIQtSVO_STF2Yey3PI9q_37fP0epOD5nKJkbPXC3uRROJhWu-n7DI1qgO8ZKUU5wNq_VVkfYjTlb8UeHukmRa_jqPGdGhsyjVxp3u1dJqa4wILb3tC6xBL5akuh58g4FiUCioqjaqpyTnfqp1uC4cujNvr-CP6hqzpyaaenurlIoeaUcJS8TbWz1vSJhN3lrHS9HoOm8mEYKVLS8qyrwZE_AY1ZNQmqx8gv6cFdUPiTEo-lQ4Qfz3Afbn_WWsIRAHypGY5PhofxlyhHrU6QrdPd4WAf85CnCnN5j7IsV1VEcMwl5yCewDPpKgXunnbN3U5rDim__rhFuOQHVOZxeoImqqXL7lA7BJqVefyIrD_iwi7Mxvw11scwl28JAIstURp4Tvfq2LNaD3yH4ENel1patBAARViMADsxUeqZGbFuyHoTz3NtQnV-kAY8c_-3G7Q-AW0orA-WjMf2o-3bJTbww_-ntZtFFi7?></g></svg>