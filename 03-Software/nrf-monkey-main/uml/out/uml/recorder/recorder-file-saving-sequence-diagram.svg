<?plantuml 1.2026.1beta5?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1305px" preserveAspectRatio="none" style="width:772px;height:1305px;background:#FFFFFF;" version="1.1" viewBox="0 0 772 1305" width="772px" zoomAndPan="magnify"><defs/><g><rect fill="#F4F4F4" height="1293.9141" style="stroke:#181818;stroke-width:0.5;" width="545.0942" x="21" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="113.769" x="236.6626" y="18.0669">Storage Thread</text><rect fill="none" height="117.5313" style="stroke:#000000;stroke-width:1.5;" width="557.0942" x="15" y="209.9609"/><rect fill="none" height="232.7344" style="stroke:#000000;stroke-width:1.5;" width="716.9194" x="15" y="485.0234"/><rect fill="none" height="81.3984" style="stroke:#000000;stroke-width:1.5;" width="681.4849" x="15" y="817.0234"/><rect fill="none" height="136.5313" style="stroke:#000000;stroke-width:1.5;" width="740.6387" x="15" y="1069.9531"/><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="Store" id="part1-lifeline"><g><title>recorder_thread_store_to_file</title><rect fill="#000000" fill-opacity="0.00000" height="1209.1875" width="8" x="150.4673" y="56.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="154" x2="154" y1="56.4297" y2="1265.6172"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="SD" id="part2-lifeline"><g><title>sdcard.c</title><rect fill="#000000" fill-opacity="0.00000" height="1209.1875" width="8" x="501.4707" y="56.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="504.8472" x2="504.8472" y1="56.4297" y2="1265.6172"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="BLE" id="part3-lifeline"><g><title>BLE Handler</title><rect fill="#000000" fill-opacity="0.00000" height="1209.1875" width="8" x="648.0068" y="56.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="651.0942" x2="651.0942" y1="56.4297" y2="1265.6172"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="Store" id="part1-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="218.9346" x="45" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="204.9346" x="52" y="45.1279">recorder_thread_store_to_file</text></g><g class="participant participant-tail" data-entity-uid="part1" data-qualified-name="Store" id="part1-tail"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="218.9346" x="45" y="1264.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="204.9346" x="52" y="1284.6123">recorder_thread_store_to_file</text></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="SD" id="part2-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73.2471" x="468.8472" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.2471" x="475.8472" y="45.1279">sdcard.c</text></g><g class="participant participant-tail" data-entity-uid="part2" data-qualified-name="SD" id="part2-tail"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73.2471" x="468.8472" y="1264.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.2471" x="475.8472" y="1284.6123">sdcard.c</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="BLE" id="part3-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99.8252" x="602.0942" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85.8252" x="609.0942" y="45.1279">BLE Handler</text></g><g class="participant participant-tail" data-entity-uid="part3" data-qualified-name="BLE" id="part3-tail"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99.8252" x="602.0942" y="1264.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85.8252" x="609.0942" y="1284.6123">BLE Handler</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="765.6387" x="0" y="86.9961"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="765.6387" y1="86.9961" y2="86.9961"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="765.6387" y1="89.9961" y2="89.9961"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="89.8481" x="337.8953" y="76.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="71.3223" x="343.8953" y="92.4966">Idle State</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg1"><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="196.4673" y1="134.7617" y2="134.7617"/><line style="stroke:#181818;stroke-width:1;" x1="196.4673" x2="196.4673" y1="134.7617" y2="147.7617"/><line style="stroke:#181818;stroke-width:1;" x1="155.4673" x2="196.4673" y1="147.7617" y2="147.7617"/><polygon fill="#181818" points="165.4673,143.7617,155.4673,147.7617,165.4673,151.7617,161.4673,147.7617" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="337.0034" x="161.4673" y="129.6958">k_sem_take(recorder_file_access_sem, K_FOREVER)</text></g><path d="M5,114.5625 L5,154.5625 L150,154.5625 L150,124.5625 L140,114.5625 L5,114.5625" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M140,114.5625 L140,124.5625 L150,124.5625 L140,114.5625" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.2109" x="11" y="131.6294">Thread sleeps until</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.3975" x="11" y="146.7622">a buffer is filled</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="765.6387" x="0" y="180.3945"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="765.6387" y1="180.3945" y2="180.3945"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="765.6387" y1="183.3945" y2="183.3945"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="203.7188" x="280.96" y="169.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="185.1929" x="286.96" y="185.895">Phase 1: File preparation</text><path d="M15,209.9609 L79.4429,209.9609 L79.4429,217.0938 L69.4429,227.0938 L15,227.0938 L15,209.9609" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="117.5313" style="stroke:#000000;stroke-width:1.5;" width="557.0942" x="15" y="209.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="30" y="223.0278">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="150.7129" x="94.4429" y="222.1714">[file_needs_init == true]</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg3"><polygon fill="#181818" points="493.4707,244.2266,503.4707,248.2266,493.4707,252.2266,497.4707,248.2266" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="499.4707" y1="248.2266" y2="248.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.937" x="161.4673" y="243.1606">sdcard_file_setup_and_open()</text></g><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg4"><polygon fill="#181818" points="165.4673,273.3594,155.4673,277.3594,165.4673,281.3594,161.4673,277.3594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="159.4673" x2="504.4707" y1="277.3594" y2="277.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52.3301" x="171.4673" y="272.2935">Success</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg5"><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="196.4673" y1="306.4922" y2="306.4922"/><line style="stroke:#181818;stroke-width:1;" x1="196.4673" x2="196.4673" y1="306.4922" y2="319.4922"/><line style="stroke:#181818;stroke-width:1;" x1="155.4673" x2="196.4673" y1="319.4922" y2="319.4922"/><polygon fill="#181818" points="165.4673,315.4922,155.4673,319.4922,165.4673,323.4922,161.4673,319.4922" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.7017" x="161.4673" y="301.4263">file_needs_init = false</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="765.6387" x="0" y="355.0586"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="765.6387" y1="355.0586" y2="355.0586"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="765.6387" y1="358.0586" y2="358.0586"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="177.1157" x="294.2615" y="344.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="158.5898" x="300.2615" y="360.5591">Phase 2: Data writing</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg6"><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="196.4673" y1="398.7578" y2="398.7578"/><line style="stroke:#181818;stroke-width:1;" x1="196.4673" x2="196.4673" y1="398.7578" y2="411.7578"/><line style="stroke:#181818;stroke-width:1;" x1="155.4673" x2="196.4673" y1="411.7578" y2="411.7578"/><polygon fill="#181818" points="165.4673,407.7578,155.4673,411.7578,165.4673,415.7578,161.4673,411.7578" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="275.1201" x="161.4673" y="393.6919">k_sem_take(file_access_sem, K_FOREVER)</text></g><path d="M448.1201,386.125 L448.1201,411.125 L721.1201,411.125 L721.1201,396.125 L711.1201,386.125 L448.1201,386.125" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M711.1201,386.125 L711.1201,396.125 L721.1201,396.125 L711.1201,386.125" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="252.2241" x="454.1201" y="403.1919">Prevents concurrent access to SD card</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg8"><polygon fill="#181818" points="493.4707,436.8906,503.4707,440.8906,493.4707,444.8906,497.4707,440.8906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="499.4707" y1="440.8906" y2="440.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266.4556" x="161.4673" y="435.8247">sdcard_write(store_block[read_idx], size)</text></g><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg9"><polygon fill="#181818" points="165.4673,466.0234,155.4673,470.0234,165.4673,474.0234,161.4673,470.0234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="159.4673" x2="504.4707" y1="470.0234" y2="470.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37.248" x="171.4673" y="464.9575">w_res</text></g><path d="M15,485.0234 L79.4429,485.0234 L79.4429,492.1563 L69.4429,502.1563 L15,502.1563 L15,485.0234" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="232.7344" style="stroke:#000000;stroke-width:1.5;" width="716.9194" x="15" y="485.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="30" y="498.0903">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="198.6499" x="94.4429" y="497.2339">[w_res == -ENOMEM (Disk Full)]</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg10"><polygon fill="#181818" points="493.4707,519.2891,503.4707,523.2891,493.4707,527.2891,497.4707,523.2891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="499.4707" y1="523.2891" y2="523.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.1611" x="161.4673" y="518.2231">sdcard_file_close()</text></g><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg11"><polygon fill="#181818" points="640.0068,548.4219,650.0068,552.4219,640.0068,556.4219,644.0068,552.4219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="646.0068" y1="552.4219" y2="552.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220.0479" x="161.4673" y="547.356">ble_update_status(ST_DISK_FULL)</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg12"><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="196.4673" y1="581.5547" y2="581.5547"/><line style="stroke:#181818;stroke-width:1;" x1="196.4673" x2="196.4673" y1="581.5547" y2="594.5547"/><line style="stroke:#181818;stroke-width:1;" x1="155.4673" x2="196.4673" y1="594.5547" y2="594.5547"/><polygon fill="#181818" points="165.4673,590.5547,155.4673,594.5547,165.4673,598.5547,161.4673,594.5547" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226.2622" x="161.4673" y="576.4888">put_device_in_power_save_mode()</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="15" x2="731.9194" y1="603.5547" y2="603.5547"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="269.4731" x="20" y="613.7651">[w_res != store_block_size (SD write error)]</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg13"><polygon fill="#181818" points="493.4707,634.4922,503.4707,638.4922,493.4707,642.4922,497.4707,638.4922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="499.4707" y1="638.4922" y2="638.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.1611" x="161.4673" y="633.4263">sdcard_file_close()</text></g><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg14"><polygon fill="#181818" points="640.0068,663.625,650.0068,667.625,640.0068,671.625,644.0068,667.625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="646.0068" y1="667.625" y2="667.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196.9932" x="161.4673" y="662.5591">ble_update_status(ST_ERROR)</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg15"><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="196.4673" y1="696.7578" y2="696.7578"/><line style="stroke:#181818;stroke-width:1;" x1="196.4673" x2="196.4673" y1="696.7578" y2="709.7578"/><line style="stroke:#181818;stroke-width:1;" x1="155.4673" x2="196.4673" y1="709.7578" y2="709.7578"/><polygon fill="#181818" points="165.4673,705.7578,155.4673,709.7578,165.4673,713.7578,161.4673,709.7578" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226.2622" x="161.4673" y="691.6919">put_device_in_power_save_mode()</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="765.6387" x="0" y="745.3242"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="765.6387" y1="745.3242" y2="745.3242"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="765.6387" y1="748.3242" y2="748.3242"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="209.5586" x="278.04" y="734.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="191.0327" x="284.04" y="750.8247">Phase 3: File change logic</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg16"><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="196.4673" y1="789.0234" y2="789.0234"/><line style="stroke:#181818;stroke-width:1;" x1="196.4673" x2="196.4673" y1="789.0234" y2="802.0234"/><line style="stroke:#181818;stroke-width:1;" x1="155.4673" x2="196.4673" y1="802.0234" y2="802.0234"/><polygon fill="#181818" points="165.4673,798.0234,155.4673,802.0234,165.4673,806.0234,161.4673,802.0234" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209.2188" x="161.4673" y="783.9575">Calculate execution time (diff_t)</text></g><path d="M15,817.0234 L79.4429,817.0234 L79.4429,824.1563 L69.4429,834.1563 L15,834.1563 L15,817.0234" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="81.3984" style="stroke:#000000;stroke-width:1.5;" width="681.4849" x="15" y="817.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="30" y="830.0903">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="358.6816" x="94.4429" y="829.2339">[diff_t &gt;= CONFIG_STORAGE_TIME_DIFF_THRESHOLD (1h)]</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg17"><polygon fill="#181818" points="493.4707,854.2891,503.4707,858.2891,493.4707,862.2891,497.4707,858.2891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="499.4707" y1="858.2891" y2="858.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.1611" x="161.4673" y="853.2231">sdcard_file_close()</text></g><path d="M510,839.1563 L510,864.1563 L681,864.1563 L681,849.1563 L671,839.1563 L510,839.1563" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M671,839.1563 L671,849.1563 L681,849.1563 L671,839.1563" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150.0142" x="516" y="856.2231">Time to create new file</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg19"><polygon fill="#181818" points="493.4707,886.4219,503.4707,890.4219,493.4707,894.4219,497.4707,890.4219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="499.4707" y1="890.4219" y2="890.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.937" x="161.4673" y="885.356">sdcard_file_setup_and_open()</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="765.6387" x="0" y="925.9883"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="765.6387" y1="925.9883" y2="925.9883"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="765.6387" y1="928.9883" y2="928.9883"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="189.6841" x="287.9773" y="915.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="171.1582" x="293.9773" y="931.4888">Phase 4: Status update</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg20"><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="196.4673" y1="969.6875" y2="969.6875"/><line style="stroke:#181818;stroke-width:1;" x1="196.4673" x2="196.4673" y1="969.6875" y2="982.6875"/><line style="stroke:#181818;stroke-width:1;" x1="155.4673" x2="196.4673" y1="982.6875" y2="982.6875"/><polygon fill="#181818" points="165.4673,978.6875,155.4673,982.6875,165.4673,986.6875,161.4673,982.6875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206.1021" x="161.4673" y="964.6216">Calculate total_days_of_records</text></g><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg21"><polygon fill="#181818" points="640.0068,1007.8203,650.0068,1011.8203,640.0068,1015.8203,644.0068,1011.8203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="646.0068" y1="1011.8203" y2="1011.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239.6177" x="161.4673" y="1006.7544">ble_update_status(main_state, days)</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="765.6387" x="0" y="1040.3867"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="765.6387" y1="1040.3867" y2="1040.3867"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="765.6387" y1="1043.3867" y2="1043.3867"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="252.5767" x="256.531" y="1029.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="234.0508" x="262.531" y="1045.8872">Phase 5: Closing sdcard session</text><path d="M15,1069.9531 L79.4429,1069.9531 L79.4429,1077.0859 L69.4429,1087.0859 L15,1087.0859 L15,1069.9531" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="136.5313" style="stroke:#000000;stroke-width:1.5;" width="740.6387" x="15" y="1069.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="30" y="1083.02">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="394.6089" x="94.4429" y="1082.1636">[is_saving_enable == false &amp;&amp; is_recorder_file_opened == true]</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg22"><polygon fill="#181818" points="493.4707,1107.2188,503.4707,1111.2188,493.4707,1115.2188,497.4707,1111.2188" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="499.4707" y1="1111.2188" y2="1111.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.1611" x="161.4673" y="1106.1528">sdcard_file_close()</text></g><path d="M510,1092.0859 L510,1117.0859 L740,1117.0859 L740,1102.0859 L730,1092.0859 L510,1092.0859" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M730,1092.0859 L730,1102.0859 L740,1102.0859 L730,1092.0859" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209.168" x="516" y="1109.1528">Close file if recording is stopped</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg24"><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="196.4673" y1="1143.3516" y2="1143.3516"/><line style="stroke:#181818;stroke-width:1;" x1="196.4673" x2="196.4673" y1="1143.3516" y2="1156.3516"/><line style="stroke:#181818;stroke-width:1;" x1="155.4673" x2="196.4673" y1="1156.3516" y2="1156.3516"/><polygon fill="#181818" points="165.4673,1152.3516,155.4673,1156.3516,165.4673,1160.3516,161.4673,1156.3516" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203.8423" x="161.4673" y="1138.2856">is_recorder_file_opened = false</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg25"><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="196.4673" y1="1185.4844" y2="1185.4844"/><line style="stroke:#181818;stroke-width:1;" x1="196.4673" x2="196.4673" y1="1185.4844" y2="1198.4844"/><line style="stroke:#181818;stroke-width:1;" x1="155.4673" x2="196.4673" y1="1198.4844" y2="1198.4844"/><polygon fill="#181818" points="165.4673,1194.4844,155.4673,1198.4844,165.4673,1202.4844,161.4673,1198.4844" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.4551" x="161.4673" y="1180.4185">file_needs_init = true</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg26"><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="196.4673" y1="1234.6172" y2="1234.6172"/><line style="stroke:#181818;stroke-width:1;" x1="196.4673" x2="196.4673" y1="1234.6172" y2="1247.6172"/><line style="stroke:#181818;stroke-width:1;" x1="155.4673" x2="196.4673" y1="1247.6172" y2="1247.6172"/><polygon fill="#181818" points="165.4673,1243.6172,155.4673,1247.6172,165.4673,1251.6172,161.4673,1247.6172" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189.6997" x="161.4673" y="1229.5513">k_sem_give(file_access_sem)</text></g><?plantuml-src hLJRRXen47tVhvYcKhGh9LMIfYz8H6h2ag12Y83sfQqinvu5YyLUsLv8-_KTUsa2kOYaAhnuVPavS-RCSNEbAsxv0WP66p6pPe7WROs9kp-vuTOheIgk_GsNKkafd1njd9-Rkx_xnqT9SclkO6_iZULJXCdC8fTxyBvx6lv9zH0BzYmAOoLQvkCjvkWHCczOeKhS0-uWXC7jHquARkK7qPnt4jGIA6MoVUkydyCLrx946o_ITvAqsz2Z7OhAFKAxdIGnFXoUDOcW1NFcSC4ydsDwZowWOLm8T2wS7i0NrXsEyc_vA4kqeKWb5hwrBXLSYLWvgBLNvG_DuROk2hIW752S4cL0SJFZ3k6u1LqA3PN5GAHNHaTGlFGGSsf4wPZIojD-qnMWtmFe3Y5k-6X0ElHrnQXiPYhKQTPSxy3XHeNZEbRoADBwy4bQA7ZfC92SF00_QK67Umuhgtpe-YucTn9erNH63DvONABs3eJHehQMrj0y0sz27Q7IpLGRzGSic3OAkYsDc7-FabBoxkS1EFKRi-GH4IjcqJLinsNW-32_7Wxo0QGTvURGhSiosq6vA8t3zD6jeBuMtD9nNKdI6YcR-zgbumdhzCPK_TT-Ftk-0rNjcSIb4aWTO9LPaG0TNo9R61do8BLZZVTT6pRgPQ58I0bWf0BGMcF_D_fyD1gE_XNvbeO-hiKlPboJJvHcgiJpGhhWfQZBCB5uXwAEO-8LsLGgLL4mdyKMDciuQyF5yBhRksJZoN3q-J9dazuW9zQxNJQv6kNZgs6_0-dnx2tCR6fq4ZAJ6WN9YtOrhkBGl7KmjyauRKLFgias8kExYF36yv99_iinKx36g5ooiu4BJeq9Qpo0y3ZRWF29ubF9OPmRuE1exZOjIRdGJhh0K7CA7kObkWFixuV3RRyCTQ9yfM-zH7P0X95VK0Kq2G92CbDIVbMHcpuhnHVHhEtibTuNaSTElU1kKxLyucxP7m00?></g></svg>