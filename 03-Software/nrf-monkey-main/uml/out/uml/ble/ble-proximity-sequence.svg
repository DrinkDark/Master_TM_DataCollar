<?plantuml 1.2026.1beta5?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="809px" preserveAspectRatio="none" style="width:1009px;height:809px;background:#FFFFFF;" version="1.1" viewBox="0 0 1009 809" width="1009px" zoomAndPan="magnify"><defs/><g><g><title>Scan Module</title><rect fill="#FFFFFF" height="634.7344" style="stroke:#181818;stroke-width:1;" width="10" x="198.2358" y="157.8594"/></g><g><title>ble_proximity.c</title><rect fill="#FFFFFF" height="532.3359" style="stroke:#181818;stroke-width:1;" width="10" x="398.9063" y="253.2578"/></g><rect fill="none" height="570.6016" style="stroke:#000000;stroke-width:1.5;" width="851.1099" x="141.5391" y="214.9922"/><rect fill="none" height="59.2656" style="stroke:#000000;stroke-width:1.5;" width="587.9722" x="333.2954" y="268.2578"/><rect fill="none" height="437.0703" style="stroke:#000000;stroke-width:1.5;" width="659.3535" x="323.2954" y="341.5234"/><rect fill="none" height="200.4688" style="stroke:#000000;stroke-width:1.5;" width="485.9341" x="333.2954" y="521.1875"/><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="S" id="part1-lifeline"><g><title>Zephyr BLE</title><rect fill="#000000" fill-opacity="0.00000" height="719" width="8" x="48.3525" y="83.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="52" x2="52" y1="83.5938" y2="802.5938"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="SM" id="part2-lifeline"><g><title>Scan Module</title><rect fill="#000000" fill-opacity="0.00000" height="719" width="8" x="199.2358" y="83.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="202.5391" x2="202.5391" y1="83.5938" y2="802.5938"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="PROX" id="part3-lifeline"><g><title>ble_proximity.c</title><rect fill="#000000" fill-opacity="0.00000" height="719" width="8" x="399.9063" y="83.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="403.2954" x2="403.2954" y1="83.5938" y2="802.5938"/></g></g><g class="participant-lifeline" data-entity-uid="part4" data-qualified-name="BUF" id="part4-lifeline"><g><title>RAM</title><rect fill="#000000" fill-opacity="0.00000" height="719" width="8" x="917.2676" y="83.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="920.8862" x2="920.8862" y1="83.5938" y2="802.5938"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="S" id="part1-head"><rect fill="#E3E3E3" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="94.7051" x="5" y="36"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80.7051" x="12" y="55.9951">Zephyr BLE</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.7598" x="32.9727" y="72.292">Stack</text></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="SM" id="part2-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="103.3936" x="151.5391" y="52.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89.3936" x="158.5391" y="72.292">Scan Module</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="PROX" id="part3-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="121.2217" x="343.2954" y="52.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107.2217" x="350.2954" y="72.292">ble_proximity.c</text></g><g class="participant participant-head" data-entity-uid="part4" data-qualified-name="BUF" id="part4-head"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.3838" x="902.5757" y="63.9951">RAM</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96.7627" x="869.8862" y="80.292">Double Buffer</text><path d="M903.2676,15 C903.2676,5 921.2676,5 921.2676,5 C921.2676,5 939.2676,5 939.2676,15 L939.2676,41 C939.2676,51 921.2676,51 921.2676,51 C921.2676,51 903.2676,51 903.2676,41 L903.2676,15" fill="#E3E3E3" style="stroke:#181818;stroke-width:0.5;"/><path d="M903.2676,15 C903.2676,25 921.2676,25 921.2676,25 C921.2676,25 939.2676,25 939.2676,15" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g><title>Scan Module</title><rect fill="#FFFFFF" height="634.7344" style="stroke:#181818;stroke-width:1;" width="10" x="198.2358" y="157.8594"/></g><g><title>ble_proximity.c</title><rect fill="#FFFFFF" height="532.3359" style="stroke:#181818;stroke-width:1;" width="10" x="398.9063" y="253.2578"/></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1002.6489" x="0" y="114.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1002.6489" y1="114.1602" y2="114.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1002.6489" y1="117.1602" y2="117.1602"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="114.1152" x="444.2668" y="103.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="95.5894" x="450.2668" y="119.6606">Scan window</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg1"><polygon fill="#181818" points="186.2358,153.8594,196.2358,157.8594,186.2358,161.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="52.3525" x2="192.2358" y1="157.8594" y2="157.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126.8833" x="59.3525" y="152.7935">Notify device found</text></g><g class="message" data-entity-1="part2" data-entity-2="part2" id="msg2"><line style="stroke:#181818;stroke-width:1;" x1="208.2358" x2="250.2358" y1="186.9922" y2="186.9922"/><line style="stroke:#181818;stroke-width:1;" x1="250.2358" x2="250.2358" y1="186.9922" y2="199.9922"/><line style="stroke:#181818;stroke-width:1;" x1="209.2358" x2="250.2358" y1="199.9922" y2="199.9922"/><polygon fill="#181818" points="219.2358,195.9922,209.2358,199.9922,219.2358,203.9922" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.6704" x="215.2358" y="181.9263">Check Manufacturer Data</text></g><path d="M403.6704,174.3594 L403.6704,199.3594 L569.6704,199.3594 L569.6704,184.3594 L559.6704,174.3594 L403.6704,174.3594" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M559.6704,174.3594 L559.6704,184.3594 L569.6704,184.3594 L559.6704,174.3594" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.3994" x="409.6704" y="191.4263">Filter: HEI ID (0x5A02)</text><path d="M141.5391,214.9922 L205.9819,214.9922 L205.9819,222.125 L195.9819,232.125 L141.5391,232.125 L141.5391,214.9922" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="570.6016" style="stroke:#000000;stroke-width:1.5;" width="851.1099" x="141.5391" y="214.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="156.5391" y="228.0591">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="85.5776" x="220.9819" y="227.2026">[Filter match]</text><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg4"><polygon fill="#181818" points="386.9063,249.2578,396.9063,253.2578,386.9063,257.2578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="208.2358" x2="392.9063" y1="253.2578" y2="253.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152.9658" x="215.2358" y="248.1919">scanning_filter_match()</text></g><path d="M333.2954,268.2578 L409.9194,268.2578 L409.9194,275.3906 L399.9194,285.3906 L333.2954,285.3906 L333.2954,268.2578" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="59.2656" style="stroke:#000000;stroke-width:1.5;" width="587.9722" x="333.2954" y="268.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31.624" x="348.2954" y="281.3247">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="153.7529" x="424.9194" y="280.4683">[for seen_devices_count]</text><g class="message" data-entity-1="part3" data-entity-2="part3" id="msg5"><line style="stroke:#181818;stroke-width:1;" x1="408.9063" x2="450.9063" y1="306.5234" y2="306.5234"/><line style="stroke:#181818;stroke-width:1;" x1="450.9063" x2="450.9063" y1="306.5234" y2="319.5234"/><line style="stroke:#181818;stroke-width:1;" x1="409.9063" x2="450.9063" y1="319.5234" y2="319.5234"/><polygon fill="#181818" points="419.9063,315.5234,409.9063,319.5234,419.9063,323.5234" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="483.3613" x="415.9063" y="301.4575">bt_addr_le_cmp(device_address, seen_devices_during_scanning_period[i])</text></g><path d="M323.2954,341.5234 L387.7383,341.5234 L387.7383,348.6563 L377.7383,358.6563 L323.2954,358.6563 L323.2954,341.5234" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="437.0703" style="stroke:#000000;stroke-width:1.5;" width="659.3535" x="323.2954" y="341.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="338.2954" y="354.5903">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="112.1431" x="402.7383" y="353.7339">[Device is unique]</text><g class="message" data-entity-1="part3" data-entity-2="part3" id="msg6"><line style="stroke:#181818;stroke-width:1;" x1="408.9063" x2="450.9063" y1="379.7891" y2="379.7891"/><line style="stroke:#181818;stroke-width:1;" x1="450.9063" x2="450.9063" y1="379.7891" y2="392.7891"/><line style="stroke:#181818;stroke-width:1;" x1="409.9063" x2="450.9063" y1="392.7891" y2="392.7891"/><polygon fill="#181818" points="419.9063,388.7891,409.9063,392.7891,419.9063,396.7891" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.5034" x="415.9063" y="374.7231">Parse device ID &amp; RSSI</text></g><g class="message" data-entity-1="part3" data-entity-2="part3" id="msg7"><line style="stroke:#181818;stroke-width:1;" x1="408.9063" x2="450.9063" y1="421.9219" y2="421.9219"/><line style="stroke:#181818;stroke-width:1;" x1="450.9063" x2="450.9063" y1="421.9219" y2="434.9219"/><line style="stroke:#181818;stroke-width:1;" x1="409.9063" x2="450.9063" y1="434.9219" y2="434.9219"/><polygon fill="#181818" points="419.9063,430.9219,409.9063,434.9219,419.9063,438.9219" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128.0894" x="415.9063" y="416.856">Get UTC timestamp</text></g><g class="message" data-entity-1="part3" data-entity-2="part4" id="msg8"><polygon fill="#181818" points="909.2676,460.0547,919.2676,464.0547,909.2676,468.0547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="408.9063" x2="915.2676" y1="464.0547" y2="464.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="320.0742" x="415.9063" y="458.9888">Store in proximity_storage_buffers[ble_write_idx]</text></g><g class="message" data-entity-1="part3" data-entity-2="part3" id="msg9"><line style="stroke:#181818;stroke-width:1;" x1="408.9063" x2="450.9063" y1="493.1875" y2="493.1875"/><line style="stroke:#181818;stroke-width:1;" x1="450.9063" x2="450.9063" y1="493.1875" y2="506.1875"/><line style="stroke:#181818;stroke-width:1;" x1="409.9063" x2="450.9063" y1="506.1875" y2="506.1875"/><polygon fill="#181818" points="419.9063,502.1875,409.9063,506.1875,419.9063,510.1875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161.4336" x="415.9063" y="488.1216">Increment sample_offset</text></g><path d="M333.2954,521.1875 L397.7383,521.1875 L397.7383,528.3203 L387.7383,538.3203 L333.2954,538.3203 L333.2954,521.1875" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="200.4688" style="stroke:#000000;stroke-width:1.5;" width="485.9341" x="333.2954" y="521.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="348.2954" y="534.2544">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="157.1421" x="412.7383" y="533.3979">[Buffer full (512 entries)]</text><g class="message" data-entity-1="part3" data-entity-2="part3" id="msg10"><line style="stroke:#181818;stroke-width:1;" x1="408.9063" x2="450.9063" y1="559.4531" y2="559.4531"/><line style="stroke:#181818;stroke-width:1;" x1="450.9063" x2="450.9063" y1="559.4531" y2="572.4531"/><line style="stroke:#181818;stroke-width:1;" x1="409.9063" x2="450.9063" y1="572.4531" y2="572.4531"/><polygon fill="#181818" points="419.9063,568.4531,409.9063,572.4531,419.9063,576.4531" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115.2036" x="415.9063" y="554.3872">Cancel flush work</text></g><g class="message" data-entity-1="part3" data-entity-2="part3" id="msg11"><line style="stroke:#181818;stroke-width:1;" x1="408.9063" x2="450.9063" y1="601.5859" y2="601.5859"/><line style="stroke:#181818;stroke-width:1;" x1="450.9063" x2="450.9063" y1="601.5859" y2="614.5859"/><line style="stroke:#181818;stroke-width:1;" x1="409.9063" x2="450.9063" y1="614.5859" y2="614.5859"/><polygon fill="#181818" points="419.9063,610.5859,409.9063,614.5859,419.9063,618.5859" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.2896" x="415.9063" y="596.52">Rotate indices (ble_write_idx)</text></g><g class="message" data-entity-1="part3" data-entity-2="part3" id="msg12"><line style="stroke:#181818;stroke-width:1;" x1="408.9063" x2="450.9063" y1="643.7188" y2="643.7188"/><line style="stroke:#181818;stroke-width:1;" x1="450.9063" x2="450.9063" y1="643.7188" y2="656.7188"/><line style="stroke:#181818;stroke-width:1;" x1="409.9063" x2="450.9063" y1="656.7188" y2="656.7188"/><polygon fill="#181818" points="419.9063,652.7188,409.9063,656.7188,419.9063,660.7188" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216.0615" x="415.9063" y="638.6528">k_sem_give(ble_file_access_sem)</text></g><path d="M653.0615,631.0859 L653.0615,656.0859 L798.0615,656.0859 L798.0615,641.0859 L788.0615,631.0859 L653.0615,631.0859" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M788.0615,631.0859 L788.0615,641.0859 L798.0615,641.0859 L788.0615,631.0859" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.2617" x="659.0615" y="648.1528">Signal store thread</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="333.2954" x2="819.2295" y1="665.7188" y2="665.7188"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="97.1899" x="338.2954" y="675.9292">[Buffer not full]</text><g class="message" data-entity-1="part3" data-entity-2="part3" id="msg14"><line style="stroke:#181818;stroke-width:1;" x1="408.9063" x2="450.9063" y1="700.6563" y2="700.6563"/><line style="stroke:#181818;stroke-width:1;" x1="450.9063" x2="450.9063" y1="700.6563" y2="713.6563"/><line style="stroke:#181818;stroke-width:1;" x1="409.9063" x2="450.9063" y1="713.6563" y2="713.6563"/><polygon fill="#181818" points="419.9063,709.6563,409.9063,713.6563,419.9063,717.6563" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205.918" x="415.9063" y="695.5903">Reschedule flush work (10 min)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="323.2954" x2="982.6489" y1="729.6563" y2="729.6563"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="69.0938" x="328.2954" y="739.8667">[Duplicate]</text><path d="M413,748.4609 L413,773.4609 L583,773.4609 L583,758.4609 L573,748.4609 L413,748.4609" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M573,748.4609 L573,758.4609 L583,758.4609 L573,748.4609" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149.4302" x="419" y="765.5278">Ignore for current scan</text><?plantuml-src VLDDJzj04BtlhnXng8BKLW692r8g0O4sKjEYk4XL0LcRzTXUPRthxaT2_ZspQp2n8F71XvqtC-_Dl74hgLjkUGFERnNItqhXGwEOwoEDqKRKrZG8tWRSYRHSh7Y5MKgrA3pNbKB6AEgba2tN7ex-OLjlBLp-l7xGcQUC8-0EiY4e4rp3t1H1OHUU3-DBXNbhpPDifDz-5Gbpk_ZzbnNSyoLt24UBY_c3dff0KBWCPOaseIxlRXYRJ21rs4XTc0rC9enbyEKRjO5p-6MyBBTGu5eAXD84NJ36XPThxZ4o8TGhzgf6iO8vrw4aHB1eOKeCc3O4jRAgFO5kfF9ep-77zGncKnYDdyukngV7L5Jvbo0qt8kQ0NrTzIY6KXsnr59NUPbWUOADZXEmfvI4nvVqKyQqnDg2GzHvfyBbWcJu58zVglxMPUbpNXGsfw6AfXrrEUa9dViyB5G46_dqn5gqqXJtyh4ZXN5OYHrfctOZb0w2bl_9Adlwtt9B6tiPE4te4oooRBOF_HqztFsv0YyRT9utRGzybq7BfeJC6qiiDFIEoHqzaLFpPJA6kuz-sbZfCPV5q-E-pZCjB3P81dJKbb9CMJhqx_j7yPtde0nAmUZiv9H6GyU4xhX7VT3XYck12aeLN0qROrU7m0lZu_h9mt4pC1g8EDXcbJjiyagkCIMHkMZTWegu61Yc3goSoKfp1IvDrDSMUT63KRdNIuj9IVb1-kX4ZV74T_J2w6GCZTHl7AAZ-lBJq2efI3NxW9uf-qLLEXACLo22jMbZP5YsMw_0uG75zvstRFuC?></g></svg>