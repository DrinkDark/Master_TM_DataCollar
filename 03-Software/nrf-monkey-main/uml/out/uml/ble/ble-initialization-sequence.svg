<?plantuml 1.2026.1beta5?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="655px" preserveAspectRatio="none" style="width:1189px;height:655px;background:#FFFFFF;" version="1.1" viewBox="0 0 1189 655" width="1189px" zoomAndPan="magnify"><defs/><g><g><title>BLE Handler Thread</title><rect fill="#FFFFFF" height="568.3906" style="stroke:#181818;stroke-width:1;" width="10" x="316.0156" y="62.5938"/></g><g><title>BLE Stack</title><rect fill="#FFFFFF" height="58.2656" style="stroke:#181818;stroke-width:1;" width="10" x="743.7866" y="414.0547"/></g><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="Main" id="part1-lifeline"><g><title>Main Thread</title><rect fill="#000000" fill-opacity="0.00000" height="596.3906" width="8" x="51.5654" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="55" x2="55" y1="52.5938" y2="648.9844"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="APP" id="part2-lifeline"><g><title>BLE Handler Thread</title><rect fill="#000000" fill-opacity="0.00000" height="596.3906" width="8" x="317.0156" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="320.248" x2="320.248" y1="52.5938" y2="648.9844"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="SNES" id="part3-lifeline"><g><title>Speak No</title><rect fill="#000000" fill-opacity="0.00000" height="596.3906" width="8" x="621.8911" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="625.3403" x2="625.3403" y1="52.5938" y2="648.9844"/></g></g><g class="participant-lifeline" data-entity-uid="part4" data-qualified-name="S" id="part4-lifeline"><g><title>BLE Stack</title><rect fill="#000000" fill-opacity="0.00000" height="596.3906" width="8" x="744.7866" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="748.4419" x2="748.4419" y1="52.5938" y2="648.9844"/></g></g><g class="participant-lifeline" data-entity-uid="part5" data-qualified-name="HW" id="part5-lifeline"><g><title>nRF54L15</title><rect fill="#000000" fill-opacity="0.00000" height="596.3906" width="8" x="970.166" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="974.125" x2="974.125" y1="52.5938" y2="648.9844"/></g></g><g class="participant-lifeline" data-entity-uid="part6" data-qualified-name="DIS" id="part6-lifeline"><g><title>SIG Device</title><rect fill="#000000" fill-opacity="0.00000" height="596.3906" width="8" x="1097.9458" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1101.207" x2="1101.207" y1="52.5938" y2="648.9844"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="Main" id="part1-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="101.1309" x="5" y="21.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.1309" x="12" y="41.292">Main Thread</text></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="APP" id="part2-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153.5352" x="244.248" y="21.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139.5352" x="251.248" y="41.292">BLE Handler Thread</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="SNES" id="part3-head"><rect fill="#E3E3E3" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="95.1016" x="578.3403" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66.5615" x="592.6104" y="24.9951">Speak No</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.1016" x="585.3403" y="41.292">Evil Service</text></g><g class="participant participant-head" data-entity-uid="part4" data-qualified-name="S" id="part4-head"><rect fill="#E3E3E3" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="130.6895" x="683.4419" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69.46" x="714.0566" y="24.9951">BLE Stack</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116.6895" x="690.4419" y="41.292">(Host/Controller)</text></g><g class="participant participant-head" data-entity-uid="part5" data-qualified-name="HW" id="part5-head"><rect fill="#E3E3E3" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="84.082" x="932.125" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70.082" x="939.125" y="24.9951">nRF54L15</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39.6484" x="954.3418" y="41.292">Radio</text></g><g class="participant participant-head" data-entity-uid="part6" data-qualified-name="DIS" id="part6-head"><rect fill="#E3E3E3" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="151.4775" x="1026.207" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76.1934" x="1063.8491" y="24.9951">SIG Device</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137.4775" x="1033.207" y="41.292">Information Service</text></g><g><title>BLE Handler Thread</title><rect fill="#FFFFFF" height="568.3906" style="stroke:#181818;stroke-width:1;" width="10" x="316.0156" y="62.5938"/></g><g><title>BLE Stack</title><rect fill="#FFFFFF" height="58.2656" style="stroke:#181818;stroke-width:1;" width="10" x="743.7866" y="414.0547"/></g><g class="message" data-entity-1="part2" data-entity-2="part2" id="msg1"><line style="stroke:#181818;stroke-width:1;" x1="326.0156" x2="368.0156" y1="83.7266" y2="83.7266"/><line style="stroke:#181818;stroke-width:1;" x1="368.0156" x2="368.0156" y1="83.7266" y2="96.7266"/><line style="stroke:#181818;stroke-width:1;" x1="327.0156" x2="368.0156" y1="96.7266" y2="96.7266"/><polygon fill="#181818" points="337.0156,92.7266,327.0156,96.7266,337.0156,100.7266" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147.0181" x="333.0156" y="78.6606">handle_device_name()</text></g><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg2"><polygon fill="#181818" points="304.0156,132.4258,314.0156,136.4258,304.0156,140.4258" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="55.5654" x2="310.0156" y1="136.4258" y2="136.4258"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236.4502" x="62.5654" y="131.3599">k_sem_give(&amp;thread_ble_busy_sem)</text></g><path d="M331,109.7266 L331,149.7266 L514,149.7266 L514,119.7266 L504,109.7266 L331,109.7266" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M504,109.7266 L504,119.7266 L514,119.7266 L504,109.7266" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162.043" x="337" y="126.7935">Wait for the Main Thread</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135.4209" x="337" y="141.9263">to finish initialization</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1182.6846" x="0" y="175.5586"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1182.6846" y1="175.5586" y2="175.5586"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1182.6846" y1="178.5586" y2="178.5586"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="225.1865" x="478.749" y="164.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="206.6606" x="484.749" y="181.0591">Phase 1 : SNES initialization</text><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg4"><polygon fill="#181818" points="613.8911,218.2578,623.8911,222.2578,613.8911,226.2578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="326.0156" x2="619.8911" y1="222.2578" y2="222.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.6558" x="333.0156" y="217.1919">bt_snes_init(&amp;snes_cb)</text></g><path d="M630,203.125 L630,228.125 L834,228.125 L834,213.125 L824,203.125 L630,203.125" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M824,203.125 L824,213.125 L834,213.125 L824,203.125" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.6885" x="636" y="220.1919">Custom service initialization</text><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg6"><polygon fill="#181818" points="613.8911,250.3906,623.8911,254.3906,613.8911,258.3906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="326.0156" x2="619.8911" y1="254.3906" y2="254.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210.8438" x="333.0156" y="249.3247">ble_update_device_id_char_val()</text></g><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg7"><polygon fill="#181818" points="613.8911,279.5234,623.8911,283.5234,613.8911,287.5234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="326.0156" x2="619.8911" y1="283.5234" y2="283.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207.7715" x="333.0156" y="278.4575">ble_update_mic_gain_char_val()</text></g><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg8"><polygon fill="#181818" points="613.8911,308.6563,623.8911,312.6563,613.8911,316.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="326.0156" x2="619.8911" y1="312.6563" y2="312.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="267.3188" x="333.0156" y="307.5903">ble_update_mic_aada_params_char_val()</text></g><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg9"><polygon fill="#181818" points="613.8911,337.7891,623.8911,341.7891,613.8911,345.7891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="326.0156" x2="619.8911" y1="341.7891" y2="341.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="275.8755" x="333.0156" y="336.7231">ble_update_mic_aadd1_params_char_val()</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1182.6846" x="0" y="370.3555"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1182.6846" y1="370.3555" y2="370.3555"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1182.6846" y1="373.3555" y2="373.3555"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="213.7734" x="484.4556" y="359.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="195.2476" x="490.4556" y="375.856">Phase 2 : BLE initialization</text><g class="message" data-entity-1="part2" data-entity-2="part4" id="msg10"><polygon fill="#181818" points="731.7866,410.0547,741.7866,414.0547,731.7866,418.0547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="326.0156" x2="737.7866" y1="414.0547" y2="414.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74.0581" x="333.0156" y="408.9888">bt_enable()</text></g><g class="message" data-entity-1="part4" data-entity-2="part5" id="msg11"><polygon fill="#181818" points="962.166,439.1875,972.166,443.1875,962.166,447.1875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="753.7866" x2="968.166" y1="443.1875" y2="443.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128.7939" x="760.7866" y="438.1216">Init radio peripheral</text></g><g class="message" data-entity-1="part4" data-entity-2="part5" id="msg12"><polygon fill="#181818" points="962.166,468.3203,972.166,472.3203,962.166,476.3203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="748.7866" x2="968.166" y1="472.3203" y2="472.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123.6714" x="755.7866" y="467.2544">Set device address</text></g><g class="message" data-entity-1="part2" data-entity-2="part4" id="msg13"><polygon fill="#181818" points="736.7866,497.4531,746.7866,501.4531,736.7866,505.4531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="326.0156" x2="742.7866" y1="501.4531" y2="501.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.5083" x="333.0156" y="496.3872">set_ble_tx_power(+3)</text></g><g class="message" data-entity-1="part2" data-entity-2="part6" id="msg14"><polygon fill="#181818" points="1089.9458,526.5859,1099.9458,530.5859,1089.9458,534.5859" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="326.0156" x2="1095.9458" y1="530.5859" y2="530.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80.9771" x="333.0156" y="525.52">sig_dis_init()</text></g><g class="message" data-entity-1="part2" data-entity-2="part2" id="msg15"><line style="stroke:#181818;stroke-width:1;" x1="326.0156" x2="368.0156" y1="559.7188" y2="559.7188"/><line style="stroke:#181818;stroke-width:1;" x1="368.0156" x2="368.0156" y1="559.7188" y2="572.7188"/><line style="stroke:#181818;stroke-width:1;" x1="327.0156" x2="368.0156" y1="572.7188" y2="572.7188"/><polygon fill="#181818" points="337.0156,568.7188,327.0156,572.7188,337.0156,576.7188" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.6719" x="333.0156" y="554.6528">init_scanning()</text></g><g class="message" data-entity-1="part2" data-entity-2="part4" id="msg16"><polygon fill="#181818" points="736.7866,597.8516,746.7866,601.8516,736.7866,605.8516" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="326.0156" x2="742.7866" y1="601.8516" y2="601.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112.9248" x="333.0156" y="596.7856">bt_le_adv_start( )</text></g><g class="message" data-entity-1="part4" data-entity-2="part5" id="msg17"><polygon fill="#181818" points="962.166,626.9844,972.166,630.9844,962.166,634.9844" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="748.7866" x2="968.166" y1="630.9844" y2="630.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201.3794" x="755.7866" y="625.9185">Tx Adv packets (Ch 37, 38, 39)</text></g><?plantuml-src bLHTQzj047pNhrZo46JQKbmtj0sua3fkRKY3YG9-CHnhQICTbkx4tLfDykkxEhkkhBY52FHvCxEpevNyHfiQ7LRW-QaaEJgTyhOg8tzOgQonQU5iHS1kIvsL6jCDvfG4ggEKqUGbHP6iiavrZORXx2Tg0_U58ypE03sqzyU8RpTJcA79Id9TuDLYqPDAQi8DtDgLcJQwX8HSerCAuEHschnKJLWShamyivxVJwnXPqkfCjXHZl7cxll5nvlXnShSOQPjWCoMFGFp7t1DRT6LcPi7wofaRSsHa-jv4c7Aka6cq0F89cTuzpMSBg48lQei22c35SM3W0fH7M0RvQbIkMueFkSGYreBRRtrJ-tAZcAiL74wBrWOIzGCuWgu8EZalZ9iuK4RxGkG8siizNDm7aNZCImAz0H34MXJx25WFEvs412Ni6Rb3NdLOkFpS9ckJpYQR3rR6QvTFltY9tIbmMsTINH_uj6PIWjqgi5odz8_6PLELIvTlug0cA4Au-nVoyk69uX_0_qWf7O8_v_dBamoAFhxkeVfIS9jqk9cIm7EHGbSEvrGazDrGGxB7YOXXbrq80uTUHy06NLK-mOySHWjVbIr_KKkVZCwIa16kaNfN6Lw_yu7ByUwVQvyYiPea_SYt7Kf9J1hb6Vvfc8Oz9pVFy9LreIV2h67U5B0wDDR67sM_SiWwdGWghy1?></g></svg>