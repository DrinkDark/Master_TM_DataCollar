<?plantuml 1.2026.1beta5?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="626px" preserveAspectRatio="none" style="width:1046px;height:626px;background:#FFFFFF;" version="1.1" viewBox="0 0 1046 626" width="1046px" zoomAndPan="magnify"><defs/><g><g><title>proximity_flush_handler</title><rect fill="#FFFFFF" height="71.2656" style="stroke:#181818;stroke-width:1;" width="10" x="471.6646" y="479.5313"/></g><g><title>BLE</title><rect fill="#FFFFFF" height="39.6992" style="stroke:#181818;stroke-width:1;" width="10" x="716.7261" y="550.7969"/></g><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="PROX" id="part1-lifeline"><g><title>ble_proximity.c</title><rect fill="#000000" fill-opacity="0.00000" height="174.6641" width="8" x="90.3662" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="94" x2="94" y1="52.5938" y2="227.2578"/></g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:1,4;" x1="94" x2="94" y1="227.2578" y2="268.0625"/><g><title>ble_proximity.c</title><rect fill="#000000" fill-opacity="0.00000" height="149.5313" width="8" x="90.3662" y="268.0625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="94" x2="94" y1="268.0625" y2="417.5938"/></g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:1,4;" x1="94" x2="94" y1="417.5938" y2="458.3984"/><g><title>ble_proximity.c</title><rect fill="#000000" fill-opacity="0.00000" height="160.6641" width="8" x="90.3662" y="458.3984"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="94" x2="94" y1="458.3984" y2="619.0625"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="TIMER" id="part2-lifeline"><g><title>k_work_delayable</title><rect fill="#000000" fill-opacity="0.00000" height="174.6641" width="8" x="284.9849" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="288.312" x2="288.312" y1="52.5938" y2="227.2578"/></g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:1,4;" x1="288.312" x2="288.312" y1="227.2578" y2="268.0625"/><g><title>k_work_delayable</title><rect fill="#000000" fill-opacity="0.00000" height="149.5313" width="8" x="284.9849" y="268.0625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="288.312" x2="288.312" y1="268.0625" y2="417.5938"/></g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:1,4;" x1="288.312" x2="288.312" y1="417.5938" y2="458.3984"/><g><title>k_work_delayable</title><rect fill="#000000" fill-opacity="0.00000" height="160.6641" width="8" x="284.9849" y="458.3984"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="288.312" x2="288.312" y1="458.3984" y2="619.0625"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="HANDLER" id="part3-lifeline"><g><title>proximity_flush_handler</title><rect fill="#000000" fill-opacity="0.00000" height="174.6641" width="8" x="472.6646" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="476.6577" x2="476.6577" y1="52.5938" y2="227.2578"/></g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:1,4;" x1="476.6577" x2="476.6577" y1="227.2578" y2="268.0625"/><g><title>proximity_flush_handler</title><rect fill="#000000" fill-opacity="0.00000" height="149.5313" width="8" x="472.6646" y="268.0625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="476.6577" x2="476.6577" y1="268.0625" y2="417.5938"/></g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:1,4;" x1="476.6577" x2="476.6577" y1="417.5938" y2="458.3984"/><g><title>proximity_flush_handler</title><rect fill="#000000" fill-opacity="0.00000" height="160.6641" width="8" x="472.6646" y="458.3984"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="476.6577" x2="476.6577" y1="458.3984" y2="619.0625"/></g></g><g class="participant-lifeline" data-entity-uid="part4" data-qualified-name="THREAD" id="part4-lifeline"><g><title>BLE</title><rect fill="#000000" fill-opacity="0.00000" height="174.6641" width="8" x="717.7261" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="721.4829" x2="721.4829" y1="52.5938" y2="227.2578"/></g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:1,4;" x1="721.4829" x2="721.4829" y1="227.2578" y2="268.0625"/><g><title>BLE</title><rect fill="#000000" fill-opacity="0.00000" height="149.5313" width="8" x="717.7261" y="268.0625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="721.4829" x2="721.4829" y1="268.0625" y2="417.5938"/></g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:1,4;" x1="721.4829" x2="721.4829" y1="417.5938" y2="458.3984"/><g><title>BLE</title><rect fill="#000000" fill-opacity="0.00000" height="160.6641" width="8" x="717.7261" y="458.3984"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="721.4829" x2="721.4829" y1="458.3984" y2="619.0625"/></g></g><g class="participant-lifeline" data-entity-uid="part5" data-qualified-name="SD" id="part5-lifeline"><g><title>SD</title><rect fill="#000000" fill-opacity="0.00000" height="174.6641" width="8" x="914.647" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="917.8135" x2="917.8135" y1="52.5938" y2="227.2578"/></g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:1,4;" x1="917.8135" x2="917.8135" y1="227.2578" y2="268.0625"/><g><title>SD</title><rect fill="#000000" fill-opacity="0.00000" height="149.5313" width="8" x="914.647" y="268.0625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="917.8135" x2="917.8135" y1="268.0625" y2="417.5938"/></g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:1,4;" x1="917.8135" x2="917.8135" y1="417.5938" y2="458.3984"/><g><title>SD</title><rect fill="#000000" fill-opacity="0.00000" height="160.6641" width="8" x="914.647" y="458.3984"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="917.8135" x2="917.8135" y1="458.3984" y2="619.0625"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="PROX" id="part1-head"><rect fill="#E3E3E3" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="178.7324" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107.2217" x="40.7554" y="24.9951">ble_proximity.c</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="164.7324" x="12" y="41.292">(scanning_filter_match)</text></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="TIMER" id="part2-head"><rect fill="#E3E3E3" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="173.3457" x="202.312" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124.209" x="226.8804" y="24.9951">k_work_delayable</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="159.3457" x="209.312" y="41.292">(proximity_flush_work)</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="HANDLER" id="part3-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="182.0137" x="385.6577" y="21.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168.0137" x="392.6577" y="41.292">proximity_flush_handler</text></g><g class="participant participant-head" data-entity-uid="part4" data-qualified-name="THREAD" id="part4-head"><rect fill="#E3E3E3" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="122.4863" x="660.4829" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="26.25" x="708.6011" y="24.9951">BLE</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108.4863" x="667.4829" y="41.292">Storage Thread</text></g><g class="participant participant-head" data-entity-uid="part5" data-qualified-name="SD" id="part5-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="33.667" x="901.8135" y="21.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="19.667" x="908.8135" y="41.292">SD</text></g><g><title>proximity_flush_handler</title><rect fill="#FFFFFF" height="71.2656" style="stroke:#181818;stroke-width:1;" width="10" x="471.6646" y="479.5313"/></g><g><title>BLE</title><rect fill="#FFFFFF" height="39.6992" style="stroke:#181818;stroke-width:1;" width="10" x="716.7261" y="550.7969"/></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1039.6167" x="0" y="83.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1039.6167" y1="83.1602" y2="83.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1039.6167" y1="86.1602" y2="86.1602"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="216.2173" x="411.6997" y="72.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="197.6914" x="417.6997" y="88.6606">Triggering Phase (Activity)</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg1"><line style="stroke:#181818;stroke-width:1;" x1="94.3662" x2="136.3662" y1="126.8594" y2="126.8594"/><line style="stroke:#181818;stroke-width:1;" x1="136.3662" x2="136.3662" y1="126.8594" y2="139.8594"/><line style="stroke:#181818;stroke-width:1;" x1="95.3662" x2="136.3662" y1="139.8594" y2="139.8594"/><polygon fill="#181818" points="105.3662,135.8594,95.3662,139.8594,105.3662,143.8594" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.2065" x="101.3662" y="121.7935">Device scanned</text></g><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg2"><polygon fill="#181818" points="276.9849,164.9922,286.9849,168.9922,276.9849,172.9922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="94.3662" x2="282.9849" y1="168.9922" y2="168.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.6187" x="101.3662" y="163.9263">k_work_reschedule(n min)</text></g><path d="M293,181.9922 L293,221.9922 L492,221.9922 L492,191.9922 L482,181.9922 L293,181.9922" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M482,181.9922 L482,191.9922 L492,191.9922 L482,181.9922" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155.3271" x="299" y="199.0591">Timer is reset/extended</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.0073" x="299" y="214.1919">every time a collar is found</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="83.918" x="464.5476" y="251.4683">2 minutes later</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg3"><line style="stroke:#181818;stroke-width:1;" x1="94.3662" x2="136.3662" y1="289.1953" y2="289.1953"/><line style="stroke:#181818;stroke-width:1;" x1="136.3662" x2="136.3662" y1="289.1953" y2="302.1953"/><line style="stroke:#181818;stroke-width:1;" x1="95.3662" x2="136.3662" y1="302.1953" y2="302.1953"/><polygon fill="#181818" points="105.3662,298.1953,95.3662,302.1953,105.3662,306.1953" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.2065" x="101.3662" y="284.1294">Device scanned</text></g><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg4"><polygon fill="#181818" points="276.9849,327.3281,286.9849,331.3281,276.9849,335.3281" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="94.3662" x2="282.9849" y1="331.3281" y2="331.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.6187" x="101.3662" y="326.2622">k_work_reschedule(n min)</text></g><path d="M293,344.3281 L293,369.3281 L435,369.3281 L435,354.3281 L425,344.3281 L293,344.3281" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M425,344.3281 L425,354.3281 L435,354.3281 L425,344.3281" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.8433" x="299" y="361.395">Timer resets again</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1039.6167" x="0" y="395.0273"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1039.6167" y1="395.0273" y2="395.0273"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1039.6167" y1="398.0273" y2="398.0273"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="196.5269" x="421.5449" y="384.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="178.001" x="427.5449" y="400.5278">Timeout Phase (Silence)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="110.9883" x="451.0125" y="441.8042">n minutes of silence</text><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg5"><polygon fill="#181818" points="459.6646,475.5313,469.6646,479.5313,459.6646,483.5313" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="288.9849" x2="465.6646" y1="479.5313" y2="479.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.3623" x="295.9849" y="474.4653">Timer expires</text></g><g class="message" data-entity-1="part3" data-entity-2="part3" id="msg6"><line style="stroke:#181818;stroke-width:1;" x1="481.6646" x2="523.6646" y1="508.6641" y2="508.6641"/><line style="stroke:#181818;stroke-width:1;" x1="523.6646" x2="523.6646" y1="508.6641" y2="521.6641"/><line style="stroke:#181818;stroke-width:1;" x1="482.6646" x2="523.6646" y1="521.6641" y2="521.6641"/><polygon fill="#181818" points="492.6646,517.6641,482.6646,521.6641,492.6646,525.6641" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84.9951" x="488.6646" y="503.5981">Swap buffers</text></g><g class="message" data-entity-1="part3" data-entity-2="part4" id="msg7"><polygon fill="#181818" points="704.7261,546.7969,714.7261,550.7969,704.7261,554.7969" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="476.6646" x2="710.7261" y1="550.7969" y2="550.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216.0615" x="483.6646" y="545.731">k_sem_give(ble_file_access_sem)</text></g><g class="message" data-entity-1="part4" data-entity-2="part5" id="msg8"><polygon fill="#181818" points="906.647,586.4961,916.647,590.4961,906.647,594.4961" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="721.7261" x2="912.647" y1="590.4961" y2="590.4961"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167.9209" x="728.7261" y="585.4302">Write valid samples to SD</text></g><path d="M923,563.7969 L923,603.7969 L1028,603.7969 L1028,573.7969 L1018,563.7969 L923,563.7969" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M1018,563.7969 L1018,573.7969 L1028,573.7969 L1018,563.7969" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31.9097" x="929" y="580.8638">Save</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84.9697" x="929" y="595.9966">partial buffer</text><?plantuml-src lL9DYzim4BthLmnxIWvDeST22YaER67RBd6WFGJCh3IsXyYIaMHlykyx_bYJxDvxqK7lpPltPYQUsRKOi86OhfRa3QnJrrWL5wJnpkiw-8OWXOvka1Rr6IlAnz90Eg6hB2abQ6BDBRe43o-MYZRu2pUShXjzSgkeqJbsLL6oJHIA1fEkrm-04PuFl__Ubv-BLn_EXI6BLnGjgL_KYj9siHu9K_dnny_zuRx-FRb6Poo5aVwu-vKzlI_u_hG_kJpv8CdWM0T2Csa_7lQxx9wRPoEKPqfjjt0CN5KK91ayrnW9LZkTk9VUQzXkbHh2mQTlOqZu2Xdrh6NampJ8BEYOGU0vUA2eQpATfPM3XjrQEPzasbpL2Novq8_SK02EieT8wJDT4Zb3vkIeft25930WQ6yjZhJITyuejTbiuCkWsoMAO57s0VBtNyoEJYDWXUoc0SgtxzBRz7Asv3HDmnkCkiMeQCK9dTnEmc9eNkdIWoujIn-5moOatRBpD-9TJVwABRnqPKaXtZActOyv8pL5nJsjXhkM0wO2jQOO1s2jb3BqeTNoCP_Gh2Qw-Q3v9x1WFLes4B5fhUHBVZYgc-69D-pb-CVpGpkRlEqsgVu3?></g></svg>