<?plantuml 1.2026.2beta3?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="810px" preserveAspectRatio="none" style="width:795px;height:810px;background:#FFFFFF;" version="1.1" viewBox="0 0 795 810" width="795px" zoomAndPan="magnify"><defs/><g><g><title>Main Thread</title><rect fill="#FFFFFF" height="645.7227" style="stroke:#181818;stroke-width:1;" width="10" x="201.3745" y="83.7266"/></g><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="Boot" id="part1-lifeline"><g><title>Kernel</title><rect fill="#000000" fill-opacity="0.00000" height="705.9219" width="8" x="50.4629" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="54" x2="54" y1="52.5938" y2="758.5156"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="Main" id="part2-lifeline"><g><title>Main Thread</title><rect fill="#000000" fill-opacity="0.00000" height="705.9219" width="8" x="202.3745" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="205.8091" x2="205.8091" y1="52.5938" y2="758.5156"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="Flash" id="part3-lifeline"><g><title>Flash</title><rect fill="#000000" fill-opacity="0.00000" height="705.9219" width="8" x="456.6719" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="460.3276" x2="460.3276" y1="52.5938" y2="758.5156"/></g></g><g class="participant-lifeline" data-entity-uid="part4" data-qualified-name="HW" id="part4-lifeline"><g><title>Hardware</title><rect fill="#000000" fill-opacity="0.00000" height="705.9219" width="8" x="573.0898" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="577.0161" x2="577.0161" y1="52.5938" y2="758.5156"/></g></g><g class="participant-lifeline" data-entity-uid="part5" data-qualified-name="Mic" id="part5-lifeline"><g><title>Microphone</title><rect fill="#000000" fill-opacity="0.00000" height="705.9219" width="8" x="712.063" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="715.1636" x2="715.1636" y1="52.5938" y2="758.5156"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="Boot" id="part1-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="58.9258" x="25" y="21.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44.9258" x="32" y="41.292">Kernel</text></g><g class="participant participant-tail" data-entity-uid="part1" data-qualified-name="Boot" id="part1-tail"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="58.9258" x="25" y="757.5156"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44.9258" x="32" y="777.5107">Kernel</text></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="Main" id="part2-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="101.1309" x="155.8091" y="21.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.1309" x="162.8091" y="41.292">Main Thread</text></g><g class="participant participant-tail" data-entity-uid="part2" data-qualified-name="Main" id="part2-tail"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="101.1309" x="155.8091" y="757.5156"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.1309" x="162.8091" y="777.5107">Main Thread</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="Flash" id="part3-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="50.6885" x="435.3276" y="21.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36.6885" x="442.3276" y="41.292">Flash</text></g><g class="participant participant-tail" data-entity-uid="part3" data-qualified-name="Flash" id="part3-tail"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="50.6885" x="435.3276" y="757.5156"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36.6885" x="442.3276" y="777.5107">Flash</text></g><g class="participant participant-head" data-entity-uid="part4" data-qualified-name="HW" id="part4-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="82.1475" x="536.0161" y="21.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68.1475" x="543.0161" y="41.292">Hardware</text></g><g class="participant participant-tail" data-entity-uid="part4" data-qualified-name="HW" id="part4-tail"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="82.1475" x="536.0161" y="757.5156"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68.1475" x="543.0161" y="777.5107">Hardware</text></g><g class="participant participant-head" data-entity-uid="part5" data-qualified-name="Mic" id="part5-head"><rect fill="#E3E3E3" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="95.7988" x="668.1636" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.7988" x="675.1636" y="24.9951">Microphone</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.1045" x="688.5107" y="41.292">(T5848)</text></g><g class="participant participant-tail" data-entity-uid="part5" data-qualified-name="Mic" id="part5-tail"><rect fill="#E3E3E3" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="95.7988" x="668.1636" y="757.5156"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.7988" x="675.1636" y="777.5107">Microphone</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.1045" x="688.5107" y="793.8076">(T5848)</text></g><g><title>Main Thread</title><rect fill="#FFFFFF" height="645.7227" style="stroke:#181818;stroke-width:1;" width="10" x="201.3745" y="83.7266"/></g><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg1"><polygon fill="#181818" points="189.3745,79.7266,199.3745,83.7266,189.3745,87.7266,193.3745,83.7266" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="54.4629" x2="195.3745" y1="83.7266" y2="83.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127.9116" x="61.4629" y="78.6606">Start main_thread()</text></g><g class="message" data-entity-1="part2" data-entity-2="part2" id="msg2"><line style="stroke:#181818;stroke-width:1;" x1="211.3745" x2="253.3745" y1="116.9258" y2="116.9258"/><line style="stroke:#181818;stroke-width:1;" x1="253.3745" x2="253.3745" y1="116.9258" y2="129.9258"/><line style="stroke:#181818;stroke-width:1;" x1="212.3745" x2="253.3745" y1="129.9258" y2="129.9258"/><polygon fill="#181818" points="222.3745,125.9258,212.3745,129.9258,222.3745,133.9258,218.3745,129.9258" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219.8828" x="218.3745" y="111.8599">k_sem_take(thread_busy_..._sem)</text></g><path d="M459.8828,96.7266 L459.8828,136.7266 L637.8828,136.7266 L637.8828,106.7266 L627.8828,96.7266 L459.8828,96.7266" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M627.8828,96.7266 L627.8828,106.7266 L637.8828,106.7266 L627.8828,96.7266" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157.5488" x="465.8828" y="113.7935">Block BLE, Audio, FatFS,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.9014" x="465.8828" y="128.9263">and Proximity threads</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="788.9624" x="0" y="162.5586"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="788.9624" y1="162.5586" y2="162.5586"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="788.9624" y1="165.5586" y2="165.5586"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="273.1621" x="257.9001" y="151.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="254.6362" x="263.9001" y="168.0591">Phase 1 : Update flash parameters</text><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg4"><polygon fill="#181818" points="448.6719,202.2578,458.6719,206.2578,448.6719,210.2578,452.6719,206.2578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="211.3745" x2="454.6719" y1="206.2578" y2="206.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68.3706" x="218.3745" y="201.1919">flash_init()</text></g><g class="message" data-entity-1="part3" data-entity-2="part2" id="msg5"><polygon fill="#181818" points="222.3745,231.3906,212.3745,235.3906,222.3745,239.3906,218.3745,235.3906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="216.3745" x2="459.6719" y1="235.3906" y2="235.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225.2974" x="228.3745" y="230.3247">Load Device ID, Gain, AAD params</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="788.9624" x="0" y="263.957"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="788.9624" y1="263.957" y2="263.957"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="788.9624" y1="266.957" y2="266.957"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="194.356" x="297.3032" y="253.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="175.8301" x="303.3032" y="269.4575">Phase 2 : Initialize GPIO</text><g class="message" data-entity-1="part2" data-entity-2="part4" id="msg6"><polygon fill="#181818" points="565.0898,303.6563,575.0898,307.6563,565.0898,311.6563,569.0898,307.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="211.3745" x2="571.0898" y1="307.6563" y2="307.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126.8833" x="218.3745" y="302.5903">init_low_batt_gpio()</text></g><g class="message" data-entity-1="part2" data-entity-2="part4" id="msg7"><polygon fill="#181818" points="565.0898,332.7891,575.0898,336.7891,565.0898,340.7891,569.0898,336.7891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="211.3745" x2="571.0898" y1="336.7891" y2="336.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.9839" x="218.3745" y="331.7231">init_burn_collar_gpio()</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="788.9624" x="0" y="365.3555"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="788.9624" y1="365.3555" y2="365.3555"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="788.9624" y1="368.3555" y2="368.3555"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="244.8833" x="272.0396" y="354.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="226.3574" x="278.0396" y="370.856">Phase 3 : Initialize microphone</text><g class="message" data-entity-1="part2" data-entity-2="part4" id="msg8"><polygon fill="#181818" points="565.0898,405.0547,575.0898,409.0547,565.0898,413.0547,569.0898,409.0547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="211.3745" x2="571.0898" y1="409.0547" y2="409.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.1958" x="218.3745" y="403.9888">init_mic_gpio()</text></g><g class="message" data-entity-1="part2" data-entity-2="part4" id="msg9"><polygon fill="#181818" points="565.0898,434.1875,575.0898,438.1875,565.0898,442.1875,569.0898,438.1875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="211.3745" x2="571.0898" y1="438.1875" y2="438.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.4766" x="218.3745" y="433.1216">init_mic_config_gpio()</text></g><g class="message" data-entity-1="part2" data-entity-2="part4" id="msg10"><polygon fill="#181818" points="565.0898,463.3203,575.0898,467.3203,565.0898,471.3203,569.0898,467.3203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="211.3745" x2="571.0898" y1="467.3203" y2="467.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.7231" x="218.3745" y="462.2544">enable_thsel_on_mic(true)</text></g><g class="message" data-entity-1="part2" data-entity-2="part5" id="msg11"><polygon fill="#181818" points="704.063,492.4531,714.063,496.4531,704.063,500.4531,708.063,496.4531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="211.3745" x2="710.063" y1="496.4531" y2="496.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79.8472" x="218.3745" y="491.3872">mic_config()</text></g><g class="message" data-entity-1="part5" data-entity-2="part2" id="msg12"><polygon fill="#181818" points="222.3745,521.5859,212.3745,525.5859,222.3745,529.5859,218.3745,525.5859" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="216.3745" x2="715.063" y1="525.5859" y2="525.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.7227" x="228.3745" y="520.52">Mic configured</text></g><g class="message" data-entity-1="part2" data-entity-2="part4" id="msg13"><polygon fill="#181818" points="565.0898,550.7188,575.0898,554.7188,565.0898,558.7188,569.0898,554.7188" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="211.3745" x2="571.0898" y1="554.7188" y2="554.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175.9697" x="218.3745" y="549.6528">enable_thsel_on_mic(false)</text></g><g class="message" data-entity-1="part2" data-entity-2="part4" id="msg14"><polygon fill="#181818" points="565.0898,590.418,575.0898,594.418,565.0898,598.418,569.0898,594.418" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="211.3745" x2="571.0898" y1="594.418" y2="594.418"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="252.2622" x="218.3745" y="589.3521">gpio_hal_disconnect_mic_config_gpio()</text></g><path d="M582,567.7188 L582,607.7188 L725,607.7188 L725,577.7188 L715,567.7188 L582,567.7188" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M715,567.7188 L715,577.7188 L725,577.7188 L715,567.7188" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.7764" x="588" y="584.7856">Detailed in mic init</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.834" x="588" y="599.9185">sequence diagram</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="788.9624" x="0" y="633.5508"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="788.9624" y1="633.5508" y2="633.5508"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="788.9624" y1="636.5508" y2="636.5508"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="191.3027" x="298.8298" y="622.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="172.7769" x="304.8298" y="639.0513">Phase 4 : Initialize time</text><g class="message" data-entity-1="part2" data-entity-2="part2" id="msg16"><line style="stroke:#181818;stroke-width:1;" x1="211.3745" x2="253.3745" y1="677.25" y2="677.25"/><line style="stroke:#181818;stroke-width:1;" x1="253.3745" x2="253.3745" y1="677.25" y2="690.25"/><line style="stroke:#181818;stroke-width:1;" x1="212.3745" x2="253.3745" y1="690.25" y2="690.25"/><polygon fill="#181818" points="222.3745,686.25,212.3745,690.25,222.3745,694.25,218.3745,690.25" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71.3413" x="218.3745" y="672.1841">Setup time</text></g><g class="message" data-entity-1="part2" data-entity-2="part2" id="msg17"><line style="stroke:#181818;stroke-width:1;" x1="211.3745" x2="253.3745" y1="728.4492" y2="728.4492"/><line style="stroke:#181818;stroke-width:1;" x1="253.3745" x2="253.3745" y1="728.4492" y2="741.4492"/><line style="stroke:#181818;stroke-width:1;" x1="206.3745" x2="253.3745" y1="741.4492" y2="741.4492"/><polygon fill="#181818" points="216.3745,737.4492,206.3745,741.4492,216.3745,745.4492,212.3745,741.4492" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218.8481" x="218.3745" y="723.3833">k_sem_give(thread_busy_..._sem)</text></g><path d="M458.8481,703.25 L458.8481,743.25 L652.8481,743.25 L652.8481,713.25 L642.8481,703.25 L458.8481,703.25" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M642.8481,703.25 L642.8481,713.25 L652.8481,713.25 L642.8481,703.25" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141.686" x="464.8481" y="720.3169">Release all threads to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173.272" x="464.8481" y="735.4497">start concurrent execution</text><?plantuml-src ZLFRJXin47tVhnZn5AI0W5898QKIKSf51JKgLBmWMPFr93kArzxQNYxz-ewz2fkbeFRDzZapvyp5OSssGOyrt3ZhoigxcY3wbehmYipHHowvGHldg3NR5HmTRE5JzxnvFpmeYgQdmyutyfRC3c0Gcej3y0RPmbtb2NLcfFkGSMumL1dBfo5uYLu_eQUCNzw_oSsbTqtbB3tOqTtda-EJtKw3ow98Lc3lInQ4KxYD4WcrN5JCRaQx1PQH7p5IPwh8p3vYhGBLAkAQHbs4MhJXHUtlxoTWjx1E8ZslgdWAK-FADKolluxXhDNind2EyVns_63HQfXxzymrnnVe4eMYc4nWNc4WE1IbdurEBfQfVCZzfaW-m6JowYctHgYPezXo5F_TO-_usg666JroIN0r6yE5F8kXircNT5lsIEXNaeNHy6-2Y_dLzssvotl1aueoxaajC4QrQjY9vj-CHUkjAfqnw3UaNkVJKAT-dTZxQe9_B9J0qjabhzxbaCM58Pbk8AESJVHHslAU9diXl3vDoY1FUtq7qxN3Ma_wt_cNQ0AzyP6ygGgDqXmabwNoFUlRspEZY6n8Ivd9NQxsmGRwrPALKMh6bOnlgwl7mwv6hWVztAmynRR9u0UxlUB7_zZj7sGeYQ8nc_s5wCHV_b5ILTbwJ_8VwPdADhAJhwHfyBV-0000?></g></svg>