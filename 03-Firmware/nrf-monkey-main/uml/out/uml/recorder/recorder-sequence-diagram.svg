<?plantuml 1.2026.2beta3?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1649px" preserveAspectRatio="none" style="width:1210px;height:1649px;background:#FFFFFF;" version="1.1" viewBox="0 0 1210 1649" width="1210px" zoomAndPan="magnify"><defs/><g><rect fill="#F9F9F9" height="1637.7031" style="stroke:#181818;stroke-width:0.5;" width="559.1304" x="46" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="165.5596" x="242.7854" y="18.0669">I2S Acquisition Thread</text><rect fill="#F4F4F4" height="1637.7031" style="stroke:#181818;stroke-width:0.5;" width="390.1816" x="627.1304" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="113.769" x="765.3367" y="18.0669">Storage Thread</text><g><title>recorder_thread_i2s</title><rect fill="#FFFFFF" height="1275.0469" style="stroke:#181818;stroke-width:1;" width="10" x="141.9658" y="324.3594"/></g><rect fill="none" height="1133.6484" style="stroke:#000000;stroke-width:1.5;" width="1183.1372" x="10" y="458.7578"/><rect fill="none" height="630.5234" style="stroke:#000000;stroke-width:1.5;" width="1140.4546" x="20" y="576.2891"/><rect fill="none" height="283.1953" style="stroke:#000000;stroke-width:1.5;" width="1120.4546" x="30" y="629.5547"/><rect fill="none" height="109.5313" style="stroke:#000000;stroke-width:1.5;" width="1100.4546" x="40" y="796.2188"/><rect fill="none" height="94.3984" style="stroke:#000000;stroke-width:1.5;" width="938.9893" x="40" y="969.8828"/><rect fill="none" height="321.4609" style="stroke:#000000;stroke-width:1.5;" width="1153.1372" x="30" y="1263.9453"/><rect fill="none" height="67.3984" style="stroke:#000000;stroke-width:1.5;" width="1095.4136" x="40" y="1511.0078"/><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="I2S" id="part1-lifeline"><g><title>recorder_thread_i2s</title><rect fill="#000000" fill-opacity="0.00000" height="1552.9766" width="8" x="142.9658" y="56.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="146" x2="146" y1="56.4297" y2="1609.4063"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="HW" id="part2-lifeline"><g><title>I2S Hardware</title><rect fill="#000000" fill-opacity="0.00000" height="1552.9766" width="8" x="522.8701" y="56.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="526.6099" x2="526.6099" y1="56.4297" y2="1609.4063"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="Store" id="part3-lifeline"><g><title>recorder_thread_store_to_file</title><rect fill="#000000" fill-opacity="0.00000" height="1552.9766" width="8" x="756.5977" y="56.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="760.1304" x2="760.1304" y1="56.4297" y2="1609.4063"/></g></g><g class="participant-lifeline" data-entity-uid="part4" data-qualified-name="SD" id="part4-lifeline"><g><title>sdcard.c</title><rect fill="#000000" fill-opacity="0.00000" height="1552.9766" width="8" x="952.6885" y="56.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="956.0649" x2="956.0649" y1="56.4297" y2="1609.4063"/></g></g><g class="participant-lifeline" data-entity-uid="part5" data-qualified-name="BLE" id="part5-lifeline"><g><title>BLE Handler</title><rect fill="#000000" fill-opacity="0.00000" height="1552.9766" width="8" x="1099.2246" y="56.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1102.312" x2="1102.312" y1="56.4297" y2="1609.4063"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="I2S" id="part1-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153.9316" x="70" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139.9316" x="77" y="45.1279">recorder_thread_i2s</text></g><g class="participant participant-tail" data-entity-uid="part1" data-qualified-name="I2S" id="part1-tail"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153.9316" x="70" y="1608.4063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139.9316" x="77" y="1628.4014">recorder_thread_i2s</text></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="HW" id="part2-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108.5205" x="472.6099" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.5205" x="479.6099" y="45.1279">I2S Hardware</text></g><g class="participant participant-tail" data-entity-uid="part2" data-qualified-name="HW" id="part2-tail"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108.5205" x="472.6099" y="1608.4063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.5205" x="479.6099" y="1628.4014">I2S Hardware</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="Store" id="part3-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="218.9346" x="651.1304" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="204.9346" x="658.1304" y="45.1279">recorder_thread_store_to_file</text></g><g class="participant participant-tail" data-entity-uid="part3" data-qualified-name="Store" id="part3-tail"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="218.9346" x="651.1304" y="1608.4063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="204.9346" x="658.1304" y="1628.4014">recorder_thread_store_to_file</text></g><g class="participant participant-head" data-entity-uid="part4" data-qualified-name="SD" id="part4-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73.2471" x="920.0649" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.2471" x="927.0649" y="45.1279">sdcard.c</text></g><g class="participant participant-tail" data-entity-uid="part4" data-qualified-name="SD" id="part4-tail"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73.2471" x="920.0649" y="1608.4063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.2471" x="927.0649" y="1628.4014">sdcard.c</text></g><g class="participant participant-head" data-entity-uid="part5" data-qualified-name="BLE" id="part5-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99.8252" x="1053.312" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85.8252" x="1060.312" y="45.1279">BLE Handler</text></g><g class="participant participant-tail" data-entity-uid="part5" data-qualified-name="BLE" id="part5-tail"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99.8252" x="1053.312" y="1608.4063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85.8252" x="1060.312" y="1628.4014">BLE Handler</text></g><g><title>recorder_thread_i2s</title><rect fill="#FFFFFF" height="1275.0469" style="stroke:#181818;stroke-width:1;" width="10" x="141.9658" y="324.3594"/></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1203.1372" x="0" y="86.9961"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="86.9961" y2="86.9961"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="89.9961" y2="89.9961"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="110.624" x="546.2566" y="76.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="92.0981" x="552.2566" y="92.4966">Initialization</text><g class="message" data-entity-1="part1" data-entity-2="part4" id="msg1"><polygon fill="#181818" points="944.6885,126.6953,954.6885,130.6953,944.6885,134.6953,948.6885,130.6953" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="146.9658" x2="950.6885" y1="130.6953" y2="130.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107.2373" x="153.9658" y="125.6294">sdcard_file_init()</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg2"><line style="stroke:#181818;stroke-width:1;" x1="146.9658" x2="188.9658" y1="159.8281" y2="159.8281"/><line style="stroke:#181818;stroke-width:1;" x1="188.9658" x2="188.9658" y1="159.8281" y2="172.8281"/><line style="stroke:#181818;stroke-width:1;" x1="147.9658" x2="188.9658" y1="172.8281" y2="172.8281"/><polygon fill="#181818" points="157.9658,168.8281,147.9658,172.8281,157.9658,176.8281,153.9658,172.8281" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151.3662" x="153.9658" y="154.7622">recorder_i2s_initialize()</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg3"><line style="stroke:#181818;stroke-width:1;" x1="146.9658" x2="188.9658" y1="201.9609" y2="201.9609"/><line style="stroke:#181818;stroke-width:1;" x1="188.9658" x2="188.9658" y1="201.9609" y2="214.9609"/><line style="stroke:#181818;stroke-width:1;" x1="147.9658" x2="188.9658" y1="214.9609" y2="214.9609"/><polygon fill="#181818" points="157.9658,210.9609,147.9658,214.9609,157.9658,218.9609,153.9658,214.9609" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.5054" x="153.9658" y="196.895">recorder_configure_streams()</text></g><g class="message" data-entity-1="part1" data-entity-2="part5" id="msg4"><polygon fill="#181818" points="1091.2246,240.0938,1101.2246,244.0938,1091.2246,248.0938,1095.2246,244.0938" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="146.9658" x2="1097.2246" y1="244.0938" y2="244.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180.7495" x="153.9658" y="239.0278">ble_update_status(ST_IDLE)</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1203.1372" x="0" y="272.6602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="272.6602" y2="272.6602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="275.6602" y2="275.6602"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="275.8091" x="463.6641" y="262.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="257.2832" x="469.6641" y="278.1606">Phase 1: Wait for recording trigger</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg5"><line style="stroke:#181818;stroke-width:1;" x1="146.9658" x2="193.9658" y1="311.3594" y2="311.3594"/><line style="stroke:#181818;stroke-width:1;" x1="193.9658" x2="193.9658" y1="311.3594" y2="324.3594"/><line style="stroke:#181818;stroke-width:1;" x1="152.9658" x2="193.9658" y1="324.3594" y2="324.3594"/><polygon fill="#181818" points="162.9658,320.3594,152.9658,324.3594,162.9658,328.3594,158.9658,324.3594" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="365.9043" x="158.9658" y="306.2935">k_sem_take(recorder_toggle_transfer_sem, K_FOREVER)</text></g><path d="M535.9043,303.7266 L535.9043,328.7266 L732.9043,328.7266 L732.9043,313.7266 L722.9043,303.7266 L535.9043,303.7266" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M722.9043,303.7266 L722.9043,313.7266 L732.9043,313.7266 L722.9043,303.7266" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176.0205" x="541.9043" y="320.7935">Triggered by button or BLE</text><g class="message" data-entity-1="part1" data-entity-2="part5" id="msg7"><polygon fill="#181818" points="1091.2246,354.4922,1101.2246,358.4922,1091.2246,362.4922,1095.2246,358.4922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="1097.2246" y1="358.4922" y2="358.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230.6802" x="158.9658" y="353.4263">ble_update_status(ST_RECORDING)</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1203.1372" x="0" y="387.0586"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="387.0586" y2="387.0586"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="390.0586" y2="390.0586"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="296.3945" x="453.3713" y="376.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="277.8687" x="459.3713" y="392.5591">Phase 2: Calibration &amp; wait for saving</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg8"><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="193.9658" y1="430.7578" y2="430.7578"/><line style="stroke:#181818;stroke-width:1;" x1="193.9658" x2="193.9658" y1="430.7578" y2="443.7578"/><line style="stroke:#181818;stroke-width:1;" x1="152.9658" x2="193.9658" y1="443.7578" y2="443.7578"/><polygon fill="#181818" points="162.9658,439.7578,152.9658,443.7578,162.9658,447.7578,158.9658,443.7578" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140.8291" x="158.9658" y="425.6919">recorder_calibration()</text></g><path d="M10,458.7578 L86.624,458.7578 L86.624,465.8906 L76.624,475.8906 L10,475.8906 L10,458.7578" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="1133.6484" style="stroke:#000000;stroke-width:1.5;" width="1183.1372" x="10" y="458.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31.624" x="25" y="471.8247">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="163.1631" x="101.624" y="470.9683">[while is_recorder_enable]</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg9"><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="193.9658" y1="501.0898" y2="501.0898"/><line style="stroke:#181818;stroke-width:1;" x1="193.9658" x2="193.9658" y1="501.0898" y2="514.0898"/><line style="stroke:#181818;stroke-width:1;" x1="152.9658" x2="193.9658" y1="514.0898" y2="514.0898"/><polygon fill="#181818" points="162.9658,510.0898,152.9658,514.0898,162.9658,518.0898,158.9658,514.0898" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202.7759" x="158.9658" y="496.0239">k_poll(rec_events, K_FOREVER)</text></g><path d="M382.7759,480.8906 L382.7759,520.8906 L679.7759,520.8906 L679.7759,490.8906 L669.7759,480.8906 L382.7759,480.8906" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M669.7759,480.8906 L669.7759,490.8906 L679.7759,490.8906 L669.7759,480.8906" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="276.3643" x="388.7759" y="497.9575">Poll toggle saving and transfer semaphore</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152.9341" x="388.7759" y="513.0903">CPU sleeps until trigger</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1203.1372" x="0" y="546.7227"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="546.7227" y2="546.7227"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="549.7227" y2="549.7227"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="306.1128" x="448.5122" y="536.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="287.5869" x="454.5122" y="552.2231">Phase 3: Data acquisition (saving loop)</text><path d="M20,576.2891 L84.4429,576.2891 L84.4429,583.4219 L74.4429,593.4219 L20,593.4219 L20,576.2891" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="630.5234" style="stroke:#000000;stroke-width:1.5;" width="1140.4546" x="20" y="576.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="35" y="589.356">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="152.9204" x="99.4429" y="588.4995">[Toggle saving signaled]</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg11"><polygon fill="#181818" points="514.8701,610.5547,524.8701,614.5547,514.8701,618.5547,518.8701,614.5547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="520.8701" y1="614.5547" y2="614.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212.8179" x="158.9658" y="609.4888">i2s_trigger(I2S_TRIGGER_START)</text></g><path d="M30,629.5547 L106.624,629.5547 L106.624,636.6875 L96.624,646.6875 L30,646.6875 L30,629.5547" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="283.1953" style="stroke:#000000;stroke-width:1.5;" width="1120.4546" x="30" y="629.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31.624" x="45" y="642.6216">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="319.8809" x="121.624" y="641.7651">[while is_saving_enable AND !force_stop_recording]</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg12"><polygon fill="#181818" points="514.8701,663.8203,524.8701,667.8203,514.8701,671.8203,518.8701,667.8203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="520.8701" y1="667.8203" y2="667.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139.1787" x="158.9658" y="662.7544">i2s_read(mem_block)</text></g><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg13"><polygon fill="#181818" points="162.9658,692.9531,152.9658,696.9531,162.9658,700.9531,158.9658,696.9531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="156.9658" x2="525.8701" y1="696.9531" y2="696.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.5918" x="168.9658" y="691.8872">Audio Data (24-bit)</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg14"><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="193.9658" y1="726.0859" y2="726.0859"/><line style="stroke:#181818;stroke-width:1;" x1="193.9658" x2="193.9658" y1="726.0859" y2="739.0859"/><line style="stroke:#181818;stroke-width:1;" x1="152.9658" x2="193.9658" y1="739.0859" y2="739.0859"/><polygon fill="#181818" points="162.9658,735.0859,152.9658,739.0859,162.9658,743.0859,158.9658,739.0859" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190.0044" x="158.9658" y="721.02">recorder_normalize_sample()</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg15"><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="193.9658" y1="768.2188" y2="768.2188"/><line style="stroke:#181818;stroke-width:1;" x1="193.9658" x2="193.9658" y1="768.2188" y2="781.2188"/><line style="stroke:#181818;stroke-width:1;" x1="152.9658" x2="193.9658" y1="781.2188" y2="781.2188"/><polygon fill="#181818" points="162.9658,777.2188,152.9658,781.2188,162.9658,785.2188,158.9658,781.2188" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197.3359" x="158.9658" y="763.1528">Copy to store_block[write_idx]</text></g><path d="M40,796.2188 L104.4429,796.2188 L104.4429,803.3516 L94.4429,813.3516 L40,813.3516 L40,796.2188" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="109.5313" style="stroke:#000000;stroke-width:1.5;" width="1100.4546" x="40" y="796.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="55" y="809.2856">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="118.9751" x="119.4429" y="808.4292">[store_block is full]</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg16"><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="193.9658" y1="834.4844" y2="834.4844"/><line style="stroke:#181818;stroke-width:1;" x1="193.9658" x2="193.9658" y1="834.4844" y2="847.4844"/><line style="stroke:#181818;stroke-width:1;" x1="152.9658" x2="193.9658" y1="847.4844" y2="847.4844"/><polygon fill="#181818" points="162.9658,843.4844,152.9658,847.4844,162.9658,851.4844,158.9658,847.4844" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85.6616" x="158.9658" y="829.4185">Swap Buffers</text></g><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg17"><polygon fill="#181818" points="748.5977,883.1836,758.5977,887.1836,748.5977,891.1836,752.5977,887.1836" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="754.5977" y1="887.1836" y2="887.1836"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251.583" x="158.9658" y="882.1177">k_sem_give(recorder_file_access_sem)</text></g><path d="M765,860.4844 L765,900.4844 L1124,900.4844 L1124,870.4844 L1114,860.4844 L765,860.4844" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M1114,860.4844 L1114,870.4844 L1124,870.4844 L1114,860.4844" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="338.8569" x="771" y="877.5513">This interaction is detailed in the sequence diagram</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294.2139" x="771" y="892.6841">recorder-file-saving-sequence-diagram.puml.</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1203.1372" x="0" y="940.3164"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="940.3164" y2="940.3164"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="943.3164" y2="943.3164"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="270.001" x="466.5681" y="929.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="251.4751" x="472.5681" y="945.8169">Stop saving / back to record mode</text><path d="M40,969.8828 L104.4429,969.8828 L104.4429,977.0156 L94.4429,987.0156 L40,987.0156 L40,969.8828" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="94.3984" style="stroke:#000000;stroke-width:1.5;" width="938.9893" x="40" y="969.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="55" y="982.9497">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="64.394" x="119.4429" y="982.0933">[file open]</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg19"><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="193.9658" y1="1008.1484" y2="1008.1484"/><line style="stroke:#181818;stroke-width:1;" x1="193.9658" x2="193.9658" y1="1008.1484" y2="1021.1484"/><line style="stroke:#181818;stroke-width:1;" x1="152.9658" x2="193.9658" y1="1021.1484" y2="1021.1484"/><polygon fill="#181818" points="162.9658,1017.1484,152.9658,1021.1484,162.9658,1025.1484,158.9658,1021.1484" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85.6616" x="158.9658" y="1003.0825">Swap Buffers</text></g><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg20"><polygon fill="#181818" points="748.5977,1049.2813,758.5977,1053.2813,748.5977,1057.2813,752.5977,1053.2813" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="754.5977" y1="1053.2813" y2="1053.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251.583" x="158.9658" y="1048.2153">k_sem_give(recorder_file_access_sem)</text></g><path d="M765,1034.1484 L765,1059.1484 L963,1059.1484 L963,1044.1484 L953,1034.1484 L765,1034.1484" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M953,1034.1484 L953,1044.1484 L963,1044.1484 L953,1034.1484" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177.3916" x="771" y="1051.2153">Flush remaining data to SD</text><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg22"><polygon fill="#181818" points="748.5977,1088.4141,758.5977,1092.4141,748.5977,1096.4141,752.5977,1092.4141" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="754.5977" y1="1092.4141" y2="1092.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="289.6372" x="158.9658" y="1087.3481">k_sem_take(&amp;file_access_sem, K_FOREVER);</text></g><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg23"><polygon fill="#181818" points="748.5977,1120.5469,758.5977,1124.5469,748.5977,1128.5469,752.5977,1124.5469" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="754.5977" y1="1124.5469" y2="1124.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204.2168" x="158.9658" y="1119.481">k_sem_give(&amp;file_access_sem);</text></g><path d="M765,1105.4141 L765,1130.4141 L994,1130.4141 L994,1115.4141 L984,1105.4141 L765,1105.4141" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M984,1105.4141 L984,1115.4141 L994,1115.4141 L984,1105.4141" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208.5015" x="771" y="1122.481">Wait for the file closure to finish</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg25"><polygon fill="#181818" points="514.8701,1152.6797,524.8701,1156.6797,514.8701,1160.6797,518.8701,1156.6797" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="520.8701" y1="1156.6797" y2="1156.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207.873" x="158.9658" y="1151.6138">i2s_trigger(I2S_TRIGGER_DROP)</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg26"><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="193.9658" y1="1185.8125" y2="1185.8125"/><line style="stroke:#181818;stroke-width:1;" x1="193.9658" x2="193.9658" y1="1185.8125" y2="1198.8125"/><line style="stroke:#181818;stroke-width:1;" x1="152.9658" x2="193.9658" y1="1198.8125" y2="1198.8125"/><polygon fill="#181818" points="162.9658,1194.8125,152.9658,1198.8125,162.9658,1202.8125,158.9658,1198.8125" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.4736" x="158.9658" y="1180.7466">gpio_hal_force_low_i2s_gpio()</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1203.1372" x="0" y="1234.3789"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="1234.3789" y2="1234.3789"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1203.1372" y1="1237.3789" y2="1237.3789"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="174.9131" x="514.1121" y="1223.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="156.3872" x="520.1121" y="1239.8794">Phase 4: Termination</text><path d="M30,1263.9453 L94.4429,1263.9453 L94.4429,1271.0781 L84.4429,1281.0781 L30,1281.0781 L30,1263.9453" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="321.4609" style="stroke:#000000;stroke-width:1.5;" width="1153.1372" x="30" y="1263.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="45" y="1277.0122">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="162.4595" x="109.4429" y="1276.1558">[Toggle transfer signaled]</text><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg27"><polygon fill="#181818" points="748.5977,1298.2109,758.5977,1302.2109,748.5977,1306.2109,752.5977,1302.2109" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="754.5977" y1="1302.2109" y2="1302.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251.583" x="158.9658" y="1297.145">k_sem_give(recorder_file_access_sem)</text></g><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg28"><polygon fill="#181818" points="748.5977,1327.3438,758.5977,1331.3438,748.5977,1335.3438,752.5977,1331.3438" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="754.5977" y1="1331.3438" y2="1331.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="289.6372" x="158.9658" y="1326.2778">k_sem_take(&amp;file_access_sem, K_FOREVER);</text></g><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg29"><polygon fill="#181818" points="748.5977,1359.4766,758.5977,1363.4766,748.5977,1367.4766,752.5977,1363.4766" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="754.5977" y1="1363.4766" y2="1363.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204.2168" x="158.9658" y="1358.4106">k_sem_give(&amp;file_access_sem);</text></g><path d="M765,1344.3438 L765,1369.3438 L994,1369.3438 L994,1354.3438 L984,1344.3438 L765,1344.3438" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M984,1344.3438 L984,1354.3438 L994,1354.3438 L984,1344.3438" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208.5015" x="771" y="1361.4106">Wait for the file closure to finish</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg31"><polygon fill="#181818" points="514.8701,1391.6094,524.8701,1395.6094,514.8701,1399.6094,518.8701,1395.6094" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="520.8701" y1="1395.6094" y2="1395.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207.873" x="158.9658" y="1390.5435">i2s_trigger(I2S_TRIGGER_DROP)</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg32"><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="193.9658" y1="1424.7422" y2="1424.7422"/><line style="stroke:#181818;stroke-width:1;" x1="193.9658" x2="193.9658" y1="1424.7422" y2="1437.7422"/><line style="stroke:#181818;stroke-width:1;" x1="152.9658" x2="193.9658" y1="1437.7422" y2="1437.7422"/><polygon fill="#181818" points="162.9658,1433.7422,152.9658,1437.7422,162.9658,1441.7422,158.9658,1437.7422" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.4736" x="158.9658" y="1419.6763">gpio_hal_force_low_i2s_gpio()</text></g><g class="message" data-entity-1="part1" data-entity-2="part5" id="msg33"><polygon fill="#181818" points="1091.2246,1462.875,1101.2246,1466.875,1091.2246,1470.875,1095.2246,1466.875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="1097.2246" y1="1466.875" y2="1466.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180.7495" x="158.9658" y="1461.8091">ble_update_status(ST_IDLE)</text></g><g class="message" data-entity-1="part1" data-entity-2="part4" id="msg34"><polygon fill="#181818" points="944.6885,1492.0078,954.6885,1496.0078,944.6885,1500.0078,948.6885,1496.0078" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="950.6885" y1="1496.0078" y2="1496.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.1611" x="158.9658" y="1490.9419">sdcard_file_close()</text></g><path d="M40,1511.0078 L104.4429,1511.0078 L104.4429,1518.1406 L94.4429,1528.1406 L40,1528.1406 L40,1511.0078" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="67.3984" style="stroke:#000000;stroke-width:1.5;" width="1095.4136" x="40" y="1511.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="55" y="1524.0747">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="220.5962" x="119.4429" y="1523.2183">[No open collar command received]</text><g class="message" data-entity-1="part1" data-entity-2="part4" id="msg35"><polygon fill="#181818" points="944.6885,1555.8398,954.6885,1559.8398,944.6885,1563.8398,948.6885,1559.8398" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="151.9658" x2="950.6885" y1="1559.8398" y2="1559.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.1543" x="158.9658" y="1554.7739">sdcard_off_and_reset()</text></g><path d="M961,1533.1406 L961,1573.1406 L1119,1573.1406 L1119,1543.1406 L1109,1533.1406 L961,1533.1406" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M1109,1533.1406 L1109,1543.1406 L1119,1543.1406 L1109,1533.1406" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136.1953" x="967" y="1550.2075">Back in Hardware off</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133.5928" x="971.1323" y="1565.3403">apply software reset</text><?plantuml-src rLPHRzis47xNhxXbG643TTPwUQc754XY9p7M9ORjBW_B8D0Y9H6XI9QaucI_laVAaYN7Rj0L6B0OiMJnk_lklZiUPH-urCIG0lvGKYMvKGK3PqeMsMPbHepZ2TT4kXcXbCiCXkzQw-VggNx-_bqKhTGJ74s72pXBlfJSSiULX6Lk6A57yFFb1_-9zDOd71cMA4EPYLr0nNneZu1OG2TTeFTwJGnT4yC2ulekOf82Kcvu5quPah4Mtud_V9lFeX6BdOfJBYg_tWth6bcQ8FDnKgsFjxmTrFcd2KOegM0c0F5t59sUmbIY3aJmVqYGu_GqYdmoWu_e2aPGEG_yCKTehryl-yi8ceXHcW08ljX1MA9aohCIix8EKopi5kaZ7C4AYKfDYVC8uahRMopZwVZJf1_2dUN4CdW_WZl27QJAR5px6Zl3iuoPTWuL-qDiMH4xyi1wMuLLbY6LCqJQ57yZuYty7b_UpYT_JkRzI2h701tcRWJBoZ53NPzXLJg7GY6pbv0aZZzYiA4bNazaFhcudO-dDrVjR8OZk43LLgOgmHjOrxbPykWJUv7GLiwj7GeP2QKqh7Ci5d0RDoWc2KOJ0VxjwAAL45wJc3qowMn70Gzlgp13B5IorO5XFq6j8A22HEVOdlVoOlOPh61CMoYbuw8kJV0PlfhaVnt1c3W2fBKdUnltFfs-pzvR4E5WsM6tF9D4C1gMMybTts5klXyth3ry7Y_dqwkhoJnUBC_cotvZqjnqfQiODiB1sSqOVi9w9BwKIiTDopNM-zZz3kuLs7WhePA7VWUBe45JXhEISbMfq1kU35RSTS7xM7RwG2fJX8s7aHTQ-FrtqEX2wMUi8rJ39GJtrzfmx5DEd_u-pEmBqB91cI0jXUXWNf0jraJ3UPbYWzX3o33JccsQySVMDWs3XoG9izQlzb_uwEpJ76FYqZ7ZjoKs4lwap17qGV4vk1nxXtqfcKmOK4uoF2JkPSqry5o3glA36ZROm8vrMOZZ3ZlEsMZVVNE3FOwfwRfTVu4LGTbG-OeH2aLPtTsrm3u6K9h9wFib_L4vsr9UYjBc66X1SAXZyDHt9uQEvqixv-YRt67YljdXRC-OtwBNOz-rRncr0sxE0r_ae68YbCM3naUTOX8s_wuvCPxVplhHtW9acgiu9oAkHe9Gwt3w-ST-23VQD3Fk15kJcOBBvepT6MZR6NfWfFshclwlQlBV56V7vDLNZbqfTb-9V3xjOUjhUgF21eO4pqjYy58K_fp4UZ7KZkxTiYs_AarZnEFnOPdh7TwXvtwOu52hNpi13Uyb4At5CrYLkl0mU7anflpL_rFMVd_v2W00?></g></svg>