<?plantuml 1.2026.2beta3?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1323px" preserveAspectRatio="none" style="width:963px;height:1323px;background:#FFFFFF;" version="1.1" viewBox="0 0 963 1323" width="963px" zoomAndPan="magnify"><defs/><g><rect fill="#F4F4F4" height="1311.9141" style="stroke:#181818;stroke-width:0.5;" width="545.0942" x="21" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="113.769" x="236.6626" y="18.0669">Storage Thread</text><rect fill="none" height="123.5313" style="stroke:#000000;stroke-width:1.5;" width="931.3667" x="15" y="209.9609"/><rect fill="none" height="244.7344" style="stroke:#000000;stroke-width:1.5;" width="716.9194" x="15" y="491.0234"/><rect fill="none" height="81.3984" style="stroke:#000000;stroke-width:1.5;" width="681.4849" x="15" y="835.0234"/><rect fill="none" height="136.5313" style="stroke:#000000;stroke-width:1.5;" width="820.0894" x="15" y="1087.9531"/><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="Store" id="part1-lifeline"><g><title>recorder_thread_store_to_file</title><rect fill="#000000" fill-opacity="0.00000" height="1227.1875" width="8" x="150.4673" y="56.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="154" x2="154" y1="56.4297" y2="1283.6172"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="SD" id="part2-lifeline"><g><title>sdcard.c</title><rect fill="#000000" fill-opacity="0.00000" height="1227.1875" width="8" x="501.4707" y="56.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="504.8472" x2="504.8472" y1="56.4297" y2="1283.6172"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="BLE" id="part3-lifeline"><g><title>BLE Handler</title><rect fill="#000000" fill-opacity="0.00000" height="1227.1875" width="8" x="648.0068" y="56.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="651.0942" x2="651.0942" y1="56.4297" y2="1283.6172"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="Store" id="part1-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="218.9346" x="45" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="204.9346" x="52" y="45.1279">recorder_thread_store_to_file</text></g><g class="participant participant-tail" data-entity-uid="part1" data-qualified-name="Store" id="part1-tail"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="218.9346" x="45" y="1282.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="204.9346" x="52" y="1302.6123">recorder_thread_store_to_file</text></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="SD" id="part2-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73.2471" x="468.8472" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.2471" x="475.8472" y="45.1279">sdcard.c</text></g><g class="participant participant-tail" data-entity-uid="part2" data-qualified-name="SD" id="part2-tail"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73.2471" x="468.8472" y="1282.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59.2471" x="475.8472" y="1302.6123">sdcard.c</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="BLE" id="part3-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99.8252" x="602.0942" y="25.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85.8252" x="609.0942" y="45.1279">BLE Handler</text></g><g class="participant participant-tail" data-entity-uid="part3" data-qualified-name="BLE" id="part3-tail"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99.8252" x="602.0942" y="1282.6172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85.8252" x="609.0942" y="1302.6123">BLE Handler</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="956.3667" x="0" y="86.9961"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="956.3667" y1="86.9961" y2="86.9961"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="956.3667" y1="89.9961" y2="89.9961"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="89.8481" x="433.2593" y="76.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="71.3223" x="439.2593" y="92.4966">Idle State</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg1"><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="196.4673" y1="134.7617" y2="134.7617"/><line style="stroke:#181818;stroke-width:1;" x1="196.4673" x2="196.4673" y1="134.7617" y2="147.7617"/><line style="stroke:#181818;stroke-width:1;" x1="155.4673" x2="196.4673" y1="147.7617" y2="147.7617"/><polygon fill="#181818" points="165.4673,143.7617,155.4673,147.7617,165.4673,151.7617,161.4673,147.7617" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="337.0034" x="161.4673" y="129.6958">k_sem_take(recorder_file_access_sem, K_FOREVER)</text></g><path d="M5,114.5625 L5,154.5625 L150,154.5625 L150,124.5625 L140,114.5625 L5,114.5625" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M140,114.5625 L140,124.5625 L150,124.5625 L140,114.5625" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.2109" x="11" y="131.6294">Thread sleeps until</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.3975" x="11" y="146.7622">a buffer is filled</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="956.3667" x="0" y="180.3945"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="956.3667" y1="180.3945" y2="180.3945"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="956.3667" y1="183.3945" y2="183.3945"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="203.7188" x="376.324" y="169.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="185.1929" x="382.324" y="185.895">Phase 1: File preparation</text><path d="M15,209.9609 L79.4429,209.9609 L79.4429,217.0938 L69.4429,227.0938 L15,227.0938 L15,209.9609" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="123.5313" style="stroke:#000000;stroke-width:1.5;" width="931.3667" x="15" y="209.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="30" y="223.0278">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="150.7129" x="94.4429" y="222.1714">[file_needs_init == true]</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg3"><polygon fill="#181818" points="493.4707,247.2266,503.4707,251.2266,493.4707,255.2266,497.4707,251.2266" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="499.4707" y1="251.2266" y2="251.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.937" x="161.4673" y="246.1606">sdcard_file_setup_and_open()</text></g><path d="M510,232.0938 L510,257.0938 L930,257.0938 L930,242.0938 L920,232.0938 L510,232.0938" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M920,232.0938 L920,242.0938 L930,242.0938 L920,232.0938" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="399.896" x="516" y="249.1606">The file is created and opened.\The file index is incremented.</text><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg5"><polygon fill="#181818" points="165.4673,279.3594,155.4673,283.3594,165.4673,287.3594,161.4673,283.3594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="159.4673" x2="504.4707" y1="283.3594" y2="283.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52.3301" x="171.4673" y="278.2935">Success</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg6"><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="196.4673" y1="312.4922" y2="312.4922"/><line style="stroke:#181818;stroke-width:1;" x1="196.4673" x2="196.4673" y1="312.4922" y2="325.4922"/><line style="stroke:#181818;stroke-width:1;" x1="155.4673" x2="196.4673" y1="325.4922" y2="325.4922"/><polygon fill="#181818" points="165.4673,321.4922,155.4673,325.4922,165.4673,329.4922,161.4673,325.4922" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142.7017" x="161.4673" y="307.4263">file_needs_init = false</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="956.3667" x="0" y="361.0586"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="956.3667" y1="361.0586" y2="361.0586"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="956.3667" y1="364.0586" y2="364.0586"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="177.1157" x="389.6255" y="350.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="158.5898" x="395.6255" y="366.5591">Phase 2: Data writing</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg7"><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="196.4673" y1="404.7578" y2="404.7578"/><line style="stroke:#181818;stroke-width:1;" x1="196.4673" x2="196.4673" y1="404.7578" y2="417.7578"/><line style="stroke:#181818;stroke-width:1;" x1="155.4673" x2="196.4673" y1="417.7578" y2="417.7578"/><polygon fill="#181818" points="165.4673,413.7578,155.4673,417.7578,165.4673,421.7578,161.4673,417.7578" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="275.1201" x="161.4673" y="399.6919">k_sem_take(file_access_sem, K_FOREVER)</text></g><path d="M448.1201,392.125 L448.1201,417.125 L721.1201,417.125 L721.1201,402.125 L711.1201,392.125 L448.1201,392.125" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M711.1201,392.125 L711.1201,402.125 L721.1201,402.125 L711.1201,392.125" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="252.2241" x="454.1201" y="409.1919">Prevents concurrent access to SD card</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg9"><polygon fill="#181818" points="493.4707,442.8906,503.4707,446.8906,493.4707,450.8906,497.4707,446.8906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="499.4707" y1="446.8906" y2="446.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266.4556" x="161.4673" y="441.8247">sdcard_write(store_block[read_idx], size)</text></g><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg10"><polygon fill="#181818" points="165.4673,472.0234,155.4673,476.0234,165.4673,480.0234,161.4673,476.0234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="159.4673" x2="504.4707" y1="476.0234" y2="476.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="37.248" x="171.4673" y="470.9575">w_res</text></g><path d="M15,491.0234 L79.4429,491.0234 L79.4429,498.1563 L69.4429,508.1563 L15,508.1563 L15,491.0234" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="244.7344" style="stroke:#000000;stroke-width:1.5;" width="716.9194" x="15" y="491.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="30" y="504.0903">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="131.2856" x="94.4429" y="503.2339">[w_res == -ENOMEM]</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg11"><polygon fill="#181818" points="493.4707,528.2891,503.4707,532.2891,493.4707,536.2891,497.4707,532.2891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="499.4707" y1="532.2891" y2="532.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.1611" x="161.4673" y="527.2231">sdcard_file_close()</text></g><path d="M510,513.1563 L510,538.1563 L597,538.1563 L597,523.1563 L587,513.1563 L510,513.1563" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M587,513.1563 L587,523.1563 L597,523.1563 L587,513.1563" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66.6123" x="516" y="530.2231">Disk is full</text><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg13"><polygon fill="#181818" points="640.0068,560.4219,650.0068,564.4219,640.0068,568.4219,644.0068,564.4219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="646.0068" y1="564.4219" y2="564.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220.0479" x="161.4673" y="559.356">ble_update_status(ST_DISK_FULL)</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg14"><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="196.4673" y1="593.5547" y2="593.5547"/><line style="stroke:#181818;stroke-width:1;" x1="196.4673" x2="196.4673" y1="593.5547" y2="606.5547"/><line style="stroke:#181818;stroke-width:1;" x1="155.4673" x2="196.4673" y1="606.5547" y2="606.5547"/><polygon fill="#181818" points="165.4673,602.5547,155.4673,606.5547,165.4673,610.5547,161.4673,606.5547" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226.2622" x="161.4673" y="588.4888">put_device_in_power_save_mode()</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="15" x2="731.9194" y1="615.5547" y2="615.5547"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="167.5083" x="20" y="625.7651">[w_res != store_block_size]</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg15"><polygon fill="#181818" points="493.4707,649.4922,503.4707,653.4922,493.4707,657.4922,497.4707,653.4922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="499.4707" y1="653.4922" y2="653.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.1611" x="161.4673" y="648.4263">sdcard_file_close()</text></g><path d="M510,634.3594 L510,659.3594 L692,659.3594 L692,644.3594 L682,634.3594 L510,634.3594" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M682,634.3594 L682,644.3594 L692,644.3594 L682,634.3594" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161.8271" x="516" y="651.4263">Error occurs during write</text><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg17"><polygon fill="#181818" points="640.0068,681.625,650.0068,685.625,640.0068,689.625,644.0068,685.625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="646.0068" y1="685.625" y2="685.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196.9932" x="161.4673" y="680.5591">ble_update_status(ST_ERROR)</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg18"><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="196.4673" y1="714.7578" y2="714.7578"/><line style="stroke:#181818;stroke-width:1;" x1="196.4673" x2="196.4673" y1="714.7578" y2="727.7578"/><line style="stroke:#181818;stroke-width:1;" x1="155.4673" x2="196.4673" y1="727.7578" y2="727.7578"/><polygon fill="#181818" points="165.4673,723.7578,155.4673,727.7578,165.4673,731.7578,161.4673,727.7578" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226.2622" x="161.4673" y="709.6919">put_device_in_power_save_mode()</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="956.3667" x="0" y="763.3242"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="956.3667" y1="763.3242" y2="763.3242"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="956.3667" y1="766.3242" y2="766.3242"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="209.5586" x="373.4041" y="752.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="191.0327" x="379.4041" y="768.8247">Phase 3: File change logic</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg19"><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="196.4673" y1="807.0234" y2="807.0234"/><line style="stroke:#181818;stroke-width:1;" x1="196.4673" x2="196.4673" y1="807.0234" y2="820.0234"/><line style="stroke:#181818;stroke-width:1;" x1="155.4673" x2="196.4673" y1="820.0234" y2="820.0234"/><polygon fill="#181818" points="165.4673,816.0234,155.4673,820.0234,165.4673,824.0234,161.4673,820.0234" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209.2188" x="161.4673" y="801.9575">Calculate execution time (diff_t)</text></g><path d="M15,835.0234 L79.4429,835.0234 L79.4429,842.1563 L69.4429,852.1563 L15,852.1563 L15,835.0234" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="81.3984" style="stroke:#000000;stroke-width:1.5;" width="681.4849" x="15" y="835.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="30" y="848.0903">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="358.6816" x="94.4429" y="847.2339">[diff_t &gt;= CONFIG_STORAGE_TIME_DIFF_THRESHOLD (1h)]</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg20"><polygon fill="#181818" points="493.4707,872.2891,503.4707,876.2891,493.4707,880.2891,497.4707,876.2891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="499.4707" y1="876.2891" y2="876.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.1611" x="161.4673" y="871.2231">sdcard_file_close()</text></g><path d="M510,857.1563 L510,882.1563 L681,882.1563 L681,867.1563 L671,857.1563 L510,857.1563" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M671,857.1563 L671,867.1563 L681,867.1563 L671,857.1563" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150.0142" x="516" y="874.2231">Time to create new file</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg22"><polygon fill="#181818" points="493.4707,904.4219,503.4707,908.4219,493.4707,912.4219,497.4707,908.4219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="499.4707" y1="908.4219" y2="908.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.937" x="161.4673" y="903.356">sdcard_file_setup_and_open()</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="956.3667" x="0" y="943.9883"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="956.3667" y1="943.9883" y2="943.9883"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="956.3667" y1="946.9883" y2="946.9883"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="189.6841" x="383.3413" y="933.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="171.1582" x="389.3413" y="949.4888">Phase 4: Status update</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg23"><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="196.4673" y1="987.6875" y2="987.6875"/><line style="stroke:#181818;stroke-width:1;" x1="196.4673" x2="196.4673" y1="987.6875" y2="1000.6875"/><line style="stroke:#181818;stroke-width:1;" x1="155.4673" x2="196.4673" y1="1000.6875" y2="1000.6875"/><polygon fill="#181818" points="165.4673,996.6875,155.4673,1000.6875,165.4673,1004.6875,161.4673,1000.6875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206.1021" x="161.4673" y="982.6216">Calculate total_days_of_records</text></g><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg24"><polygon fill="#181818" points="640.0068,1025.8203,650.0068,1029.8203,640.0068,1033.8203,644.0068,1029.8203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="646.0068" y1="1029.8203" y2="1029.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239.6177" x="161.4673" y="1024.7544">ble_update_status(main_state, days)</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="956.3667" x="0" y="1058.3867"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="956.3667" y1="1058.3867" y2="1058.3867"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="956.3667" y1="1061.3867" y2="1061.3867"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="252.5767" x="351.895" y="1047.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="234.0508" x="357.895" y="1063.8872">Phase 5: Closing sdcard session</text><path d="M15,1087.9531 L79.4429,1087.9531 L79.4429,1095.0859 L69.4429,1105.0859 L15,1105.0859 L15,1087.9531" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="136.5313" style="stroke:#000000;stroke-width:1.5;" width="820.0894" x="15" y="1087.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="30" y="1101.02">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="735.6465" x="94.4429" y="1100.1636">[is_saving_enable == false &amp;&amp; is_recorder_file_opened == true &amp;&amp; k_sem_count_get(&amp;recorder_file_access_sem) == 0]</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg25"><polygon fill="#181818" points="493.4707,1125.2188,503.4707,1129.2188,493.4707,1133.2188,497.4707,1129.2188" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="499.4707" y1="1129.2188" y2="1129.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.1611" x="161.4673" y="1124.1528">sdcard_file_close()</text></g><path d="M510,1110.0859 L510,1135.0859 L740,1135.0859 L740,1120.0859 L730,1110.0859 L510,1110.0859" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M730,1110.0859 L730,1120.0859 L740,1120.0859 L730,1110.0859" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209.168" x="516" y="1127.1528">Close file if recording is stopped</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg27"><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="196.4673" y1="1161.3516" y2="1161.3516"/><line style="stroke:#181818;stroke-width:1;" x1="196.4673" x2="196.4673" y1="1161.3516" y2="1174.3516"/><line style="stroke:#181818;stroke-width:1;" x1="155.4673" x2="196.4673" y1="1174.3516" y2="1174.3516"/><polygon fill="#181818" points="165.4673,1170.3516,155.4673,1174.3516,165.4673,1178.3516,161.4673,1174.3516" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203.8423" x="161.4673" y="1156.2856">is_recorder_file_opened = false</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg28"><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="196.4673" y1="1203.4844" y2="1203.4844"/><line style="stroke:#181818;stroke-width:1;" x1="196.4673" x2="196.4673" y1="1203.4844" y2="1216.4844"/><line style="stroke:#181818;stroke-width:1;" x1="155.4673" x2="196.4673" y1="1216.4844" y2="1216.4844"/><polygon fill="#181818" points="165.4673,1212.4844,155.4673,1216.4844,165.4673,1220.4844,161.4673,1216.4844" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.4551" x="161.4673" y="1198.4185">file_needs_init = true</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg29"><line style="stroke:#181818;stroke-width:1;" x1="154.4673" x2="196.4673" y1="1252.6172" y2="1252.6172"/><line style="stroke:#181818;stroke-width:1;" x1="196.4673" x2="196.4673" y1="1252.6172" y2="1265.6172"/><line style="stroke:#181818;stroke-width:1;" x1="155.4673" x2="196.4673" y1="1265.6172" y2="1265.6172"/><polygon fill="#181818" points="165.4673,1261.6172,155.4673,1265.6172,165.4673,1269.6172,161.4673,1265.6172" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189.6997" x="161.4673" y="1247.5513">k_sem_give(file_access_sem)</text></g><?plantuml-src dLLHJo8n47xVNp7d9OPDrAZdlP1WSigYvaG8SFToNfhQpaB3qcxQhd3tws_QHGN5u04lfPrEl_c-cGytLRhabi-WQxGH4sjc2DvMcBZdapwtNWbLSktxN4gbnt1wl79-OHPF-oV7IV9W5h0tzCRoCS9eOf7BFVZSEGlVf7p91NiMXR4IBVCnYZcwXCmRbgi2zu0x26bm_PAJWbjv9EhpTe9Q0ZsPh4TTt6PmpRKiqCP0-fqahHRSq0vbvHwXrKgIc1yEp-k7e0bJvd36F9zYunbTGCEu4EXSE3s0xwpJ6sG_iq6QQ4EP2inzSragk0AnT51fhufxpU6XodEqe1nGdW9bGD6VS8TmqeGEfORIOY3IAwCZA5vuY6zgHEcOqihJVgqAqES5T9iGrtpK81twgcHKDZCbwaOQmoD4gyQJY15ZwW1745oF4YWSGZZAe_kNSorn4QAKfhWPQeeygbzlm-4AOSCg4lCAsFBmJHMGyy9Xq2nvuU6q2MtkESojyg69jWcpLOzbiNsBZmISAZLQLDRI6kfhu4se8n2t-jGAdG4BDkg6V2YCcFwA7QhaulS1EFKNq-GL4NDcqTNYnMMGx32xwtMpxXRLH64SRX2hhTmqzarL5EifGdStuO7kLgKa4MbokAzSOpXYxPiXqV7ZzZRTB4bPUIRnKGaaILXfvjJWZZyYcnaPG23fiopWKmjM262XwXqhoQmr5emW5Hp8oWQL8yCVBYiR37g3NKjQwxOlowaJ4wx9e0epLc9portoGbH5i0fSeAZYV7f5_jYGAi-PJwFOzHhEMt3Pk-lSNB7Xg3VuTfMnqKqt8paw7JQw7cJ3wzvj6nedatH73aVXPUhRUcn1upoEr_ywmZePPyreXXNvLMHy6n7UU5umoVyuPd9MEwHBjWeuuoHCMEC1XClf2eIlb9zA3YrH0mT74xhgXSe5EIc0eUQKF4nMz17Otm-7wqPTMzcJOOQGsZg48KjcO_ID_VUSFGstZdVK9nJnP9uvr4-4ecY0QOhAafn_O_U-My3IApzehF7V8OhxZdMErUCRwqp_0G00?></g></svg>