<?plantuml 1.2026.2beta2?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="784px" preserveAspectRatio="none" style="width:651px;height:784px;background:#FFFFFF;" version="1.1" viewBox="0 0 651 784" width="651px" zoomAndPan="magnify"><defs/><g><rect fill="#F9F9F9" height="765.9844" style="stroke:#181818;stroke-width:0.5;" width="129.8574" x="16" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="119.666" x="21.0957" y="18.0669">Producer thread</text><rect fill="#FFFFFF" height="765.9844" style="stroke:#181818;stroke-width:0.5;" width="142.123" x="153.3379" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="89.4575" x="179.6707" y="18.0669">Shared RAM</text><rect fill="#F9F9F9" height="765.9844" style="stroke:#181818;stroke-width:0.5;" width="132.7944" x="306.9902" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="126.7944" x="309.9902" y="18.0669">Consumer thread</text><rect fill="none" height="188.7969" style="stroke:#000000;stroke-width:1.5;" width="624.8223" x="10" y="147.5625"/><rect fill="none" height="188.7969" style="stroke:#000000;stroke-width:1.5;" width="624.8223" x="10" y="500.8906"/><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="Rec" id="part1-lifeline"><g><title>Audio Recorder</title><rect fill="#000000" fill-opacity="0.00000" height="619.2578" width="8" x="76.9287" y="87.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="80" x2="80" y1="87.4297" y2="706.6875"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="B0" id="part2-lifeline"><g><title>Buffer 0</title><rect fill="#000000" fill-opacity="0.00000" height="619.2578" width="8" x="184.3687" y="87.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="188.3379" x2="188.3379" y1="87.4297" y2="706.6875"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="B1" id="part3-lifeline"><g><title>Buffer 1</title><rect fill="#000000" fill-opacity="0.00000" height="619.2578" width="8" x="256.4302" y="87.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="260.3994" x2="260.3994" y1="87.4297" y2="706.6875"/></g></g><g class="participant-lifeline" data-entity-uid="part4" data-qualified-name="Store" id="part4-lifeline"><g><title>File Store</title><rect fill="#000000" fill-opacity="0.00000" height="619.2578" width="8" x="369.3875" y="87.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="373.2844" x2="373.2844" y1="87.4297" y2="706.6875"/></g></g><g class="participant-lifeline" data-entity-uid="part5" data-qualified-name="SD" id="part5-lifeline"><g><title>SD card</title><rect fill="#000000" fill-opacity="0.00000" height="619.2578" width="8" x="586.3042" y="87.4297"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="589.7861" x2="589.7861" y1="87.4297" y2="706.6875"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="Rec" id="part1-head"><rect fill="#E3E3E3" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="121.8574" x="20" y="39.8359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107.8574" x="27" y="59.8311">Audio Recorder</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32.8467" x="64.5054" y="76.1279">(I2S)</text></g><g class="participant participant-tail" data-entity-uid="part1" data-qualified-name="Rec" id="part1-tail"><rect fill="#E3E3E3" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="121.8574" x="20" y="705.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107.8574" x="27" y="725.6826">Audio Recorder</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32.8467" x="64.5054" y="741.9795">(I2S)</text></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="B0" id="part2-head"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56.0615" x="157.3379" y="84.1279">Buffer 0</text><path d="M170.3687,35.1328 C170.3687,25.1328 188.3687,25.1328 188.3687,25.1328 C188.3687,25.1328 206.3687,25.1328 206.3687,35.1328 L206.3687,61.1328 C206.3687,71.1328 188.3687,71.1328 188.3687,71.1328 C188.3687,71.1328 170.3687,71.1328 170.3687,61.1328 L170.3687,35.1328" fill="#E3E3E3" style="stroke:#181818;stroke-width:0.5;"/><path d="M170.3687,35.1328 C170.3687,45.1328 188.3687,45.1328 188.3687,45.1328 C188.3687,45.1328 206.3687,45.1328 206.3687,35.1328" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-entity-uid="part2" data-qualified-name="B0" id="part2-tail"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56.0615" x="157.3379" y="718.6826">Buffer 0</text><path d="M170.3687,731.9844 C170.3687,721.9844 188.3687,721.9844 188.3687,721.9844 C188.3687,721.9844 206.3687,721.9844 206.3687,731.9844 L206.3687,757.9844 C206.3687,767.9844 188.3687,767.9844 188.3687,767.9844 C188.3687,767.9844 170.3687,767.9844 170.3687,757.9844 L170.3687,731.9844" fill="#E3E3E3" style="stroke:#181818;stroke-width:0.5;"/><path d="M170.3687,731.9844 C170.3687,741.9844 188.3687,741.9844 188.3687,741.9844 C188.3687,741.9844 206.3687,741.9844 206.3687,731.9844" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="B1" id="part3-head"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56.0615" x="229.3994" y="84.1279">Buffer 1</text><path d="M242.4302,35.1328 C242.4302,25.1328 260.4302,25.1328 260.4302,25.1328 C260.4302,25.1328 278.4302,25.1328 278.4302,35.1328 L278.4302,61.1328 C278.4302,71.1328 260.4302,71.1328 260.4302,71.1328 C260.4302,71.1328 242.4302,71.1328 242.4302,61.1328 L242.4302,35.1328" fill="#E3E3E3" style="stroke:#181818;stroke-width:0.5;"/><path d="M242.4302,35.1328 C242.4302,45.1328 260.4302,45.1328 260.4302,45.1328 C260.4302,45.1328 278.4302,45.1328 278.4302,35.1328" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-entity-uid="part3" data-qualified-name="B1" id="part3-tail"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56.0615" x="229.3994" y="718.6826">Buffer 1</text><path d="M242.4302,731.9844 C242.4302,721.9844 260.4302,721.9844 260.4302,721.9844 C260.4302,721.9844 278.4302,721.9844 278.4302,731.9844 L278.4302,757.9844 C278.4302,767.9844 260.4302,767.9844 260.4302,767.9844 C260.4302,767.9844 242.4302,767.9844 242.4302,757.9844 L242.4302,731.9844" fill="#E3E3E3" style="stroke:#181818;stroke-width:0.5;"/><path d="M242.4302,731.9844 C242.4302,741.9844 260.4302,741.9844 260.4302,741.9844 C260.4302,741.9844 278.4302,741.9844 278.4302,731.9844" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-entity-uid="part4" data-qualified-name="Store" id="part4-head"><rect fill="#E3E3E3" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="80.2061" x="333.2844" y="39.8359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66.2061" x="340.2844" y="59.8311">File Store</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54.0449" x="346.365" y="76.1279">(FATFS)</text></g><g class="participant participant-tail" data-entity-uid="part4" data-qualified-name="Store" id="part4-tail"><rect fill="#E3E3E3" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="80.2061" x="333.2844" y="705.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66.2061" x="340.2844" y="725.6826">File Store</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54.0449" x="346.365" y="741.9795">(FATFS)</text></g><g class="participant participant-head" data-entity-uid="part5" data-qualified-name="SD" id="part5-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="69.0361" x="555.7861" y="56.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.0361" x="562.7861" y="76.1279">SD card</text></g><g class="participant participant-tail" data-entity-uid="part5" data-qualified-name="SD" id="part5-tail"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="69.0361" x="555.7861" y="705.6875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55.0361" x="562.7861" y="725.6826">SD card</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="644.8223" x="0" y="117.9961"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="644.8223" y1="117.9961" y2="117.9961"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="644.8223" y1="120.9961" y2="120.9961"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="205.0771" x="219.8726" y="107.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="186.5513" x="225.8726" y="123.4966">Cycle A: Fill B0 / Write B1</text><path d="M10,147.5625 L220.1533,147.5625 L220.1533,154.6953 L210.1533,164.6953 L10,164.6953 L10,147.5625" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="188.7969" style="stroke:#000000;stroke-width:1.5;" width="624.8223" x="10" y="147.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="165.1533" x="25" y="160.6294">Concurrent operations</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg1"><polygon fill="#181818" points="176.3687,181.8281,186.3687,185.8281,176.3687,189.8281,180.3687,185.8281" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="80.9287" x2="182.3687" y1="185.8281" y2="185.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.4399" x="87.9287" y="180.7622">Fill with data</text></g><g class="message" data-entity-1="part4" data-entity-2="part3" id="msg2"><polygon fill="#181818" points="271.4302,210.9609,261.4302,214.9609,271.4302,218.9609,267.4302,214.9609" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="265.4302" x2="372.3875" y1="214.9609" y2="214.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66.6631" x="277.4302" y="209.895">Read data</text></g><g class="message" data-entity-1="part4" data-entity-2="part4" id="msg3"><line style="stroke:#181818;stroke-width:1;" x1="373.3875" x2="415.3875" y1="244.0938" y2="244.0938"/><line style="stroke:#181818;stroke-width:1;" x1="415.3875" x2="415.3875" y1="244.0938" y2="257.0938"/><line style="stroke:#181818;stroke-width:1;" x1="374.3875" x2="415.3875" y1="257.0938" y2="257.0938"/><polygon fill="#181818" points="384.3875,253.0938,374.3875,257.0938,384.3875,261.0938,380.3875,257.0938" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180.6226" x="380.3875" y="239.0278">Take file access semaphore</text></g><g class="message" data-entity-1="part4" data-entity-2="part5" id="msg4"><polygon fill="#181818" points="578.3042,282.2266,588.3042,286.2266,578.3042,290.2266,582.3042,286.2266" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="373.3875" x2="584.3042" y1="286.2266" y2="286.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34.9058" x="380.3875" y="281.1606">Write</text></g><g class="message" data-entity-1="part4" data-entity-2="part4" id="msg5"><line style="stroke:#181818;stroke-width:1;" x1="373.3875" x2="415.3875" y1="315.3594" y2="315.3594"/><line style="stroke:#181818;stroke-width:1;" x1="415.3875" x2="415.3875" y1="315.3594" y2="328.3594"/><line style="stroke:#181818;stroke-width:1;" x1="374.3875" x2="415.3875" y1="328.3594" y2="328.3594"/><polygon fill="#181818" points="384.3875,324.3594,374.3875,328.3594,384.3875,332.3594,380.3875,328.3594" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.5659" x="380.3875" y="310.2935">Give file access semaphore</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="644.8223" x="0" y="363.9258"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="644.8223" y1="363.9258" y2="363.9258"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="644.8223" y1="366.9258" y2="366.9258"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="171.3584" x="236.7319" y="353.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="152.8325" x="242.7319" y="369.4263">Cycle B: Buffer Swap</text><g class="message" data-entity-1="part1" data-entity-2="part4" id="msg6"><polygon fill="#181818" points="361.3875,403.625,371.3875,407.625,361.3875,411.625,365.3875,407.625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="80.9287" x2="367.3875" y1="407.625" y2="407.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.6978" x="87.9287" y="402.5591">Give semaphore</text></g><path d="M153,420.625 L153,445.625 L293,445.625 L293,430.625 L283,420.625 L153,420.625" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M283,420.625 L283,430.625 L293,430.625 L283,420.625" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.9961" x="159" y="437.6919">Buffers swap roles</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="644.8223" x="0" y="471.3242"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="644.8223" y1="471.3242" y2="471.3242"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="644.8223" y1="474.3242" y2="474.3242"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="204.5566" x="220.1328" y="460.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="186.0308" x="226.1328" y="476.8247">Cycle C: Fill B1 / Write B0</text><path d="M10,500.8906 L220.1533,500.8906 L220.1533,508.0234 L210.1533,518.0234 L10,518.0234 L10,500.8906" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="188.7969" style="stroke:#000000;stroke-width:1.5;" width="624.8223" x="10" y="500.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="165.1533" x="25" y="513.9575">Concurrent operations</text><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg7"><polygon fill="#181818" points="248.4302,535.1563,258.4302,539.1563,248.4302,543.1563,252.4302,539.1563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="80.9287" x2="254.4302" y1="539.1563" y2="539.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83.4399" x="87.9287" y="534.0903">Fill with data</text></g><g class="message" data-entity-1="part4" data-entity-2="part2" id="msg8"><polygon fill="#181818" points="199.3687,564.2891,189.3687,568.2891,199.3687,572.2891,195.3687,568.2891" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="193.3687" x2="372.3875" y1="568.2891" y2="568.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66.6631" x="205.3687" y="563.2231">Read data</text></g><g class="message" data-entity-1="part4" data-entity-2="part4" id="msg9"><line style="stroke:#181818;stroke-width:1;" x1="373.3875" x2="415.3875" y1="597.4219" y2="597.4219"/><line style="stroke:#181818;stroke-width:1;" x1="415.3875" x2="415.3875" y1="597.4219" y2="610.4219"/><line style="stroke:#181818;stroke-width:1;" x1="374.3875" x2="415.3875" y1="610.4219" y2="610.4219"/><polygon fill="#181818" points="384.3875,606.4219,374.3875,610.4219,384.3875,614.4219,380.3875,610.4219" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180.6226" x="380.3875" y="592.356">Take file access semaphore</text></g><g class="message" data-entity-1="part4" data-entity-2="part5" id="msg10"><polygon fill="#181818" points="578.3042,635.5547,588.3042,639.5547,578.3042,643.5547,582.3042,639.5547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="373.3875" x2="584.3042" y1="639.5547" y2="639.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34.9058" x="380.3875" y="634.4888">Write</text></g><g class="message" data-entity-1="part4" data-entity-2="part4" id="msg11"><line style="stroke:#181818;stroke-width:1;" x1="373.3875" x2="415.3875" y1="668.6875" y2="668.6875"/><line style="stroke:#181818;stroke-width:1;" x1="415.3875" x2="415.3875" y1="668.6875" y2="681.6875"/><line style="stroke:#181818;stroke-width:1;" x1="374.3875" x2="415.3875" y1="681.6875" y2="681.6875"/><polygon fill="#181818" points="384.3875,677.6875,374.3875,681.6875,384.3875,685.6875,380.3875,681.6875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178.5659" x="380.3875" y="663.6216">Give file access semaphore</text></g><?plantuml-src nP7DRjim48JlV8g5Scc1195wgm4Ny0ySz52Wi0BqaikQN5c49L9OKd7pzbrHQcAdBjgS8bq4pkx7cL4uMDSXOmkjTrxNx5k2o3sfyAo46eq_MhU72fjmgdIe3xYdCZur14mwejitfDJE_uJiEtlJQsA8DHEQ3AwgpyEhG1xPZrRR3bs4RD4Rws5BshCXVd0VldugFsQ0OJXJv0m8SAAMDJ8Ps2w-2V1OsqY9Pp3Y3WD1jkohIYxDq_uolwmMergyWg-y2ttxFvOtLXANqJE9tStYVZCPJaSlrBETSWqQsOnpQwNcSrWzQU4iPY2yHjp2BVnWoIJMO3vNU_Pz1-9Azyma3DyHOxHYCrcIUk3cox0t4OusrYbjafEPD538m5OINT36ZndSuu6W6cAXrXG216gnguSuv_Dh6KucBtFkxEFVE5BBIUhb3AQ_KHwn6-9ESSv8pzkWd9TY_ACiBFFhCTC8a3i60lk6mia5gz-r5Y-rvc-fjVXNhVaVjRvZjRy0?></g></svg>