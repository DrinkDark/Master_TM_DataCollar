<?plantuml 1.2026.2beta3?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="537px" preserveAspectRatio="none" style="width:1082px;height:537px;background:#FFFFFF;" version="1.1" viewBox="0 0 1082 537" width="1082px" zoomAndPan="magnify"><defs/><g><g><title>proximity_flush_handler</title><rect fill="#FFFFFF" height="71.2656" style="stroke:#181818;stroke-width:1;" width="10" x="471.6646" y="406.1328"/></g><g><title>BLE</title><rect fill="#FFFFFF" height="32.1328" style="stroke:#181818;stroke-width:1;" width="10" x="716.7261" y="477.3984"/></g><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="PROX" id="part1-lifeline"><g><title>ble_proximity.c</title><rect fill="#000000" fill-opacity="0.00000" height="130.3984" width="8" x="90.3662" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="94" x2="94" y1="52.5938" y2="182.9922"/></g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:1,4;" x1="94" x2="94" y1="182.9922" y2="223.7969"/><g><title>ble_proximity.c</title><rect fill="#000000" fill-opacity="0.00000" height="120.3984" width="8" x="90.3662" y="223.7969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="94" x2="94" y1="223.7969" y2="344.1953"/></g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:1,4;" x1="94" x2="94" y1="344.1953" y2="385"/><g><title>ble_proximity.c</title><rect fill="#000000" fill-opacity="0.00000" height="145.5313" width="8" x="90.3662" y="385"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="94" x2="94" y1="385" y2="530.5313"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="TIMER" id="part2-lifeline"><g><title>k_work_delayable</title><rect fill="#000000" fill-opacity="0.00000" height="130.3984" width="8" x="284.9849" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="288.312" x2="288.312" y1="52.5938" y2="182.9922"/></g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:1,4;" x1="288.312" x2="288.312" y1="182.9922" y2="223.7969"/><g><title>k_work_delayable</title><rect fill="#000000" fill-opacity="0.00000" height="120.3984" width="8" x="284.9849" y="223.7969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="288.312" x2="288.312" y1="223.7969" y2="344.1953"/></g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:1,4;" x1="288.312" x2="288.312" y1="344.1953" y2="385"/><g><title>k_work_delayable</title><rect fill="#000000" fill-opacity="0.00000" height="145.5313" width="8" x="284.9849" y="385"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="288.312" x2="288.312" y1="385" y2="530.5313"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="HANDLER" id="part3-lifeline"><g><title>proximity_flush_handler</title><rect fill="#000000" fill-opacity="0.00000" height="130.3984" width="8" x="472.6646" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="476.6577" x2="476.6577" y1="52.5938" y2="182.9922"/></g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:1,4;" x1="476.6577" x2="476.6577" y1="182.9922" y2="223.7969"/><g><title>proximity_flush_handler</title><rect fill="#000000" fill-opacity="0.00000" height="120.3984" width="8" x="472.6646" y="223.7969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="476.6577" x2="476.6577" y1="223.7969" y2="344.1953"/></g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:1,4;" x1="476.6577" x2="476.6577" y1="344.1953" y2="385"/><g><title>proximity_flush_handler</title><rect fill="#000000" fill-opacity="0.00000" height="145.5313" width="8" x="472.6646" y="385"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="476.6577" x2="476.6577" y1="385" y2="530.5313"/></g></g><g class="participant-lifeline" data-entity-uid="part4" data-qualified-name="THREAD" id="part4-lifeline"><g><title>BLE</title><rect fill="#000000" fill-opacity="0.00000" height="130.3984" width="8" x="717.7261" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="721.4829" x2="721.4829" y1="52.5938" y2="182.9922"/></g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:1,4;" x1="721.4829" x2="721.4829" y1="182.9922" y2="223.7969"/><g><title>BLE</title><rect fill="#000000" fill-opacity="0.00000" height="120.3984" width="8" x="717.7261" y="223.7969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="721.4829" x2="721.4829" y1="223.7969" y2="344.1953"/></g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:1,4;" x1="721.4829" x2="721.4829" y1="344.1953" y2="385"/><g><title>BLE</title><rect fill="#000000" fill-opacity="0.00000" height="145.5313" width="8" x="717.7261" y="385"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="721.4829" x2="721.4829" y1="385" y2="530.5313"/></g></g><g class="participant-lifeline" data-entity-uid="part5" data-qualified-name="SD" id="part5-lifeline"><g><title>SD</title><rect fill="#000000" fill-opacity="0.00000" height="130.3984" width="8" x="914.647" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="917.8135" x2="917.8135" y1="52.5938" y2="182.9922"/></g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:1,4;" x1="917.8135" x2="917.8135" y1="182.9922" y2="223.7969"/><g><title>SD</title><rect fill="#000000" fill-opacity="0.00000" height="120.3984" width="8" x="914.647" y="223.7969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="917.8135" x2="917.8135" y1="223.7969" y2="344.1953"/></g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:1,4;" x1="917.8135" x2="917.8135" y1="344.1953" y2="385"/><g><title>SD</title><rect fill="#000000" fill-opacity="0.00000" height="145.5313" width="8" x="914.647" y="385"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="917.8135" x2="917.8135" y1="385" y2="530.5313"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="PROX" id="part1-head"><rect fill="#E3E3E3" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="178.7324" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107.2217" x="40.7554" y="24.9951">ble_proximity.c</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="164.7324" x="12" y="41.292">(scanning_filter_match)</text></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="TIMER" id="part2-head"><rect fill="#E3E3E3" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="173.3457" x="202.312" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124.209" x="226.8804" y="24.9951">k_work_delayable</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="159.3457" x="209.312" y="41.292">(proximity_flush_work)</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="HANDLER" id="part3-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="182.0137" x="385.6577" y="21.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168.0137" x="392.6577" y="41.292">proximity_flush_handler</text></g><g class="participant participant-head" data-entity-uid="part4" data-qualified-name="THREAD" id="part4-head"><rect fill="#E3E3E3" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="122.4863" x="660.4829" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="26.25" x="708.6011" y="24.9951">BLE</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108.4863" x="667.4829" y="41.292">Storage Thread</text></g><g class="participant participant-head" data-entity-uid="part5" data-qualified-name="SD" id="part5-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="33.667" x="901.8135" y="21.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="19.667" x="908.8135" y="41.292">SD</text></g><g><title>proximity_flush_handler</title><rect fill="#FFFFFF" height="71.2656" style="stroke:#181818;stroke-width:1;" width="10" x="471.6646" y="406.1328"/></g><g><title>BLE</title><rect fill="#FFFFFF" height="32.1328" style="stroke:#181818;stroke-width:1;" width="10" x="716.7261" y="477.3984"/></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1075.6587" x="0" y="83.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1075.6587" y1="83.1602" y2="83.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1075.6587" y1="86.1602" y2="86.1602"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="216.2173" x="429.7207" y="72.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="197.6914" x="435.7207" y="88.6606">Triggering Phase (Activity)</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg1"><line style="stroke:#181818;stroke-width:1;" x1="94.3662" x2="136.3662" y1="126.8594" y2="126.8594"/><line style="stroke:#181818;stroke-width:1;" x1="136.3662" x2="136.3662" y1="126.8594" y2="139.8594"/><line style="stroke:#181818;stroke-width:1;" x1="95.3662" x2="136.3662" y1="139.8594" y2="139.8594"/><polygon fill="#181818" points="105.3662,135.8594,95.3662,139.8594,105.3662,143.8594" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.2065" x="101.3662" y="121.7935">Device scanned</text></g><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg2"><polygon fill="#181818" points="276.9849,167.9922,286.9849,171.9922,276.9849,175.9922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="94.3662" x2="282.9849" y1="171.9922" y2="171.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.6187" x="101.3662" y="166.9263">k_work_reschedule(n min)</text></g><path d="M293,152.8594 L293,177.8594 L651,177.8594 L651,162.8594 L641,152.8594 L293,152.8594" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M641,152.8594 L641,162.8594 L651,162.8594 L641,152.8594" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="337.4668" x="299" y="169.9263">Timer is reset/extended every time a collar is found</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="83.918" x="464.5476" y="207.2026">2 minutes later</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg4"><line style="stroke:#181818;stroke-width:1;" x1="94.3662" x2="136.3662" y1="244.9297" y2="244.9297"/><line style="stroke:#181818;stroke-width:1;" x1="136.3662" x2="136.3662" y1="244.9297" y2="257.9297"/><line style="stroke:#181818;stroke-width:1;" x1="95.3662" x2="136.3662" y1="257.9297" y2="257.9297"/><polygon fill="#181818" points="105.3662,253.9297,95.3662,257.9297,105.3662,261.9297" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103.2065" x="101.3662" y="239.8638">Device scanned</text></g><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg5"><polygon fill="#181818" points="276.9849,286.0625,286.9849,290.0625,276.9849,294.0625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="94.3662" x2="282.9849" y1="290.0625" y2="290.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.6187" x="101.3662" y="284.9966">k_work_reschedule(n min)</text></g><path d="M293,270.9297 L293,295.9297 L435,295.9297 L435,280.9297 L425,270.9297 L293,270.9297" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M425,270.9297 L425,280.9297 L435,280.9297 L425,270.9297" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.8433" x="299" y="287.9966">Timer resets again</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1075.6587" x="0" y="321.6289"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1075.6587" y1="321.6289" y2="321.6289"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1075.6587" y1="324.6289" y2="324.6289"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="196.5269" x="439.5659" y="311.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="178.001" x="445.5659" y="327.1294">Timeout Phase (Silence)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="83.8911" x="464.561" y="368.4058">n minutes later</text><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg7"><polygon fill="#181818" points="459.6646,402.1328,469.6646,406.1328,459.6646,410.1328" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="288.9849" x2="465.6646" y1="406.1328" y2="406.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.3623" x="295.9849" y="401.0669">Timer expires</text></g><g class="message" data-entity-1="part3" data-entity-2="part3" id="msg8"><line style="stroke:#181818;stroke-width:1;" x1="481.6646" x2="523.6646" y1="435.2656" y2="435.2656"/><line style="stroke:#181818;stroke-width:1;" x1="523.6646" x2="523.6646" y1="435.2656" y2="448.2656"/><line style="stroke:#181818;stroke-width:1;" x1="482.6646" x2="523.6646" y1="448.2656" y2="448.2656"/><polygon fill="#181818" points="492.6646,444.2656,482.6646,448.2656,492.6646,452.2656" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84.9951" x="488.6646" y="430.1997">Swap buffers</text></g><g class="message" data-entity-1="part3" data-entity-2="part4" id="msg9"><polygon fill="#181818" points="704.7261,473.3984,714.7261,477.3984,704.7261,481.3984" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="476.6646" x2="710.7261" y1="477.3984" y2="477.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216.0615" x="483.6646" y="472.3325">k_sem_give(ble_file_access_sem)</text></g><g class="message" data-entity-1="part4" data-entity-2="part5" id="msg10"><polygon fill="#181818" points="906.647,505.5313,916.647,509.5313,906.647,513.5313" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="721.7261" x2="912.647" y1="509.5313" y2="509.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167.9209" x="728.7261" y="504.4653">Write valid samples to SD</text></g><path d="M923,490.3984 L923,515.3984 L1065,515.3984 L1065,500.3984 L1055,490.3984 L923,490.3984" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M1055,490.3984 L1055,500.3984 L1065,500.3984 L1055,490.3984" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.0117" x="929" y="507.4653">Save partial buffer</text><?plantuml-src jLB1Rjim3BthAuYUaiCoOCS16P310JgWxOeum7OeOB0oRHEH9KEItUJlHykkaNIxxgA3tkCZtoF3YMs77bi8yM98NiywzgrHOK5QPvrkl6i9ek_f2kbGdx2cF9LwqX5jRKWfGIDhxj16k7irL7JUdRdbUDde5xiA6grbMnSLcqY-Q37gPdq76E3vyFFtRVcfU7F-L9Hay8AY9VMBMb6PFZI9C9KVVppk3xVr7yaDsjAGJ_JxtLFsyB7W-yF-nURHUN46nyOJbfFs_M6_oswvUPQWF5DgkuMZvxecByxWkS50iDhfo8FqNiDsgzHe3ZvzIoRXAsGqi9R8npIeND3aGU3PkAUW6ofxGoiBBTkriYvAsbmtKLX7Ria31ua_KFnCvqYsf19e87-1A2WWQ6SC9bRbUbkgpMO3NqQnFb80Wx84aB__E62QBW3Mo7RAIhvT7z-3ojcGrPHo6gUp_vXkwYi3p6jRnEdSiJHGEAOjz6MlxyIRclmDEtZjgufyk6PC-qs-0hL5pGEjnjkL8wK2jQOGHc2jb2hfhrRBntmcivhevgFcBy-23MYuX81jPyHPTEFXt8ILuq2GBWpDFEDriqdq3m00?></g></svg>