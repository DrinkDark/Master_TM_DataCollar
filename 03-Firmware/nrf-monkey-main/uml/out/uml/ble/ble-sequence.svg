<?plantuml 1.2026.2beta3?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="803px" preserveAspectRatio="none" style="width:1253px;height:803px;background:#FFFFFF;" version="1.1" viewBox="0 0 1253 803" width="1253px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="608.6563" style="stroke:#000000;stroke-width:1.5;" width="1226.9741" x="10" y="170.9922"/><rect fill="none" height="110.5313" style="stroke:#000000;stroke-width:1.5;" width="1066.3521" x="30" y="195.125"/><rect fill="none" height="452.9922" style="stroke:#000000;stroke-width:1.5;" width="1206.9741" x="20" y="319.6563"/><rect fill="none" height="52.2656" style="stroke:#000000;stroke-width:1.5;" width="1186.9741" x="30" y="460.3203"/><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="APP" id="part1-lifeline"><g><title>BLE Handler</title><rect fill="#000000" fill-opacity="0.00000" height="744.0547" width="8" x="85.9126" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="89" x2="89" y1="52.5938" y2="796.6484"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="S" id="part2-lifeline"><g><title>BLE Stack</title><rect fill="#000000" fill-opacity="0.00000" height="744.0547" width="8" x="815.8584" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="819.5137" x2="819.5137" y1="52.5938" y2="796.6484"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="HW" id="part3-lifeline"><g><title>nRF54L15</title><rect fill="#000000" fill-opacity="0.00000" height="744.0547" width="8" x="1040.311" y="52.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1044.27" x2="1044.27" y1="52.5938" y2="796.6484"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="APP" id="part1-head"><rect fill="#E3E3E3" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="99.8252" x="40" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85.8252" x="47" y="24.9951">BLE Handler</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49.2598" x="65.2827" y="41.292">Thread</text></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="S" id="part2-head"><rect fill="#E3E3E3" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="130.6895" x="754.5137" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69.46" x="785.1284" y="24.9951">BLE Stack</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116.6895" x="761.5137" y="41.292">(Host/Controller)</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="HW" id="part3-head"><rect fill="#E3E3E3" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="84.082" x="1002.27" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70.082" x="1009.27" y="24.9951">nRF54L15</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39.6484" x="1024.4868" y="41.292">Radio</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1246.9741" x="0" y="83.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1246.9741" y1="83.1602" y2="83.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1246.9741" y1="86.1602" y2="86.1602"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="278.0625" x="484.4558" y="72.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="259.5366" x="490.4558" y="88.6606">Execution Phase (Operational loop)</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg1"><polygon fill="#181818" points="807.8584,122.8594,817.8584,126.8594,807.8584,130.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="89.9126" x2="813.8584" y1="126.8594" y2="126.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229.1694" x="96.9126" y="121.7935">bt_le_adv_start(adv_param, ad, sd)</text></g><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg2"><polygon fill="#181818" points="1032.311,151.9922,1042.311,155.9922,1032.311,159.9922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="819.8584" x2="1038.311" y1="155.9922" y2="155.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200.4526" x="826.8584" y="150.9263">Tx adv packets (Ch 37, 38, 39)</text></g><path d="M10,170.9922 L86.624,170.9922 L86.624,178.125 L76.624,188.125 L10,188.125 L10,170.9922" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="608.6563" style="stroke:#000000;stroke-width:1.5;" width="1226.9741" x="10" y="170.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31.624" x="25" y="184.0591">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="144.4824" x="101.624" y="183.2026">[while (system_active)]</text><path d="M30,195.125 L94.4429,195.125 L94.4429,202.2578 L84.4429,212.2578 L30,212.2578 L30,195.125" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="110.5313" style="stroke:#000000;stroke-width:1.5;" width="1066.3521" x="30" y="195.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="45" y="208.1919">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="157.9854" x="109.4429" y="207.3354">[Advertise data changed]</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg3"><polygon fill="#181818" points="807.8584,232.3906,817.8584,236.3906,807.8584,240.3906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="89.9126" x2="813.8584" y1="236.3906" y2="236.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.5898" x="96.9126" y="231.3247">bt_le_adv_stop()</text></g><path d="M824,217.2578 L824,242.2578 L1065,242.2578 L1065,227.2578 L1055,217.2578 L824,217.2578" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M1055,217.2578 L1055,227.2578 L1065,227.2578 L1055,217.2578" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220.4097" x="830" y="234.3247">Restart advertising with new data</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg5"><polygon fill="#181818" points="807.8584,264.5234,817.8584,268.5234,807.8584,272.5234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="89.9126" x2="813.8584" y1="268.5234" y2="268.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229.1694" x="96.9126" y="263.4575">bt_le_adv_start(adv_param, ad, sd)</text></g><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg6"><polygon fill="#181818" points="1032.311,293.6563,1042.311,297.6563,1032.311,301.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="819.8584" x2="1038.311" y1="297.6563" y2="297.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200.4526" x="826.8584" y="292.5903">Tx adv packets (Ch 37, 38, 39)</text></g><path d="M20,319.6563 L84.4429,319.6563 L84.4429,326.7891 L74.4429,336.7891 L20,336.7891 L20,319.6563" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="452.9922" style="stroke:#000000;stroke-width:1.5;" width="1206.9741" x="20" y="319.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="35" y="332.7231">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="185.9688" x="99.4429" y="331.8667">[Proximity detection enabled]</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg7"><polygon fill="#181818" points="807.8584,353.9219,817.8584,357.9219,807.8584,361.9219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="89.9126" x2="813.8584" y1="357.9219" y2="357.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.5898" x="96.9126" y="352.856">bt_le_adv_stop()</text></g><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg8"><polygon fill="#181818" points="1032.311,383.0547,1042.311,387.0547,1032.311,391.0547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="819.8584" x2="1038.311" y1="387.0547" y2="387.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46.4775" x="826.8584" y="381.9888">Stop tx</text></g><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg9"><polygon fill="#181818" points="807.8584,412.1875,817.8584,416.1875,807.8584,420.1875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="89.9126" x2="813.8584" y1="416.1875" y2="416.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="254.1157" x="96.9126" y="411.1216">bt_le_scan_start(scan_param, scan_cb)</text></g><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg10"><polygon fill="#181818" points="1032.311,441.3203,1042.311,445.3203,1032.311,449.3203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="819.8584" x2="1038.311" y1="445.3203" y2="445.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105.3457" x="826.8584" y="440.2544">Open rx window</text></g><path d="M30,460.3203 L106.624,460.3203 L106.624,467.4531 L96.624,477.4531 L30,477.4531 L30,460.3203" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="52.2656" style="stroke:#000000;stroke-width:1.5;" width="1186.9741" x="30" y="460.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31.624" x="45" y="473.3872">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="124.2119" x="121.624" y="472.5308">[for each discovery]</text><g class="message" data-entity-1="part3" data-entity-2="part1" id="msg11"><line style="stroke:#181818;stroke-width:1;" x1="90.9126" x2="100.9126" y1="501.5859" y2="497.5859"/><line style="stroke:#181818;stroke-width:1;" x1="90.9126" x2="100.9126" y1="501.5859" y2="505.5859"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="89.9126" x2="1043.311" y1="501.5859" y2="501.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="400.5815" x="106.9126" y="496.52">scanning_filter_match(device_info, filter_match, connectable)</text></g><path d="M1049,482.4531 L1049,507.4531 L1201,507.4531 L1201,492.4531 L1191,482.4531 L1049,482.4531" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M1191,482.4531 L1191,492.4531 L1201,492.4531 L1191,482.4531" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131.6631" x="1055" y="499.52">Filter &amp; log to buffer</text><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg13"><line style="stroke:#181818;stroke-width:1;" x1="89.9126" x2="131.9126" y1="540.7188" y2="540.7188"/><line style="stroke:#181818;stroke-width:1;" x1="131.9126" x2="131.9126" y1="540.7188" y2="553.7188"/><line style="stroke:#181818;stroke-width:1;" x1="90.9126" x2="131.9126" y1="553.7188" y2="553.7188"/><polygon fill="#181818" points="100.9126,549.7188,90.9126,553.7188,100.9126,557.7188" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157.4155" x="96.9126" y="535.6528">k_msleep(scan_window)</text></g><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg14"><polygon fill="#181818" points="807.8584,578.8516,817.8584,582.8516,807.8584,586.8516" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="89.9126" x2="813.8584" y1="582.8516" y2="582.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112.8042" x="96.9126" y="577.7856">bt_le_scan_stop()</text></g><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg15"><polygon fill="#181818" points="1032.311,607.9844,1042.311,611.9844,1032.311,615.9844" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="819.8584" x2="1038.311" y1="611.9844" y2="611.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.0376" x="826.8584" y="606.9185">Close rx window</text></g><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg16"><polygon fill="#181818" points="807.8584,637.1172,817.8584,641.1172,807.8584,645.1172" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="89.9126" x2="813.8584" y1="641.1172" y2="641.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229.1694" x="96.9126" y="636.0513">bt_le_adv_start(adv_param, ad, sd)</text></g><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg17"><polygon fill="#181818" points="1032.311,666.25,1042.311,670.25,1032.311,674.25" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="819.8584" x2="1038.311" y1="670.25" y2="670.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200.4526" x="826.8584" y="665.1841">Tx adv packets (Ch 37, 38, 39)</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg18"><line style="stroke:#181818;stroke-width:1;" x1="89.9126" x2="131.9126" y1="703.4492" y2="703.4492"/><line style="stroke:#181818;stroke-width:1;" x1="131.9126" x2="131.9126" y1="703.4492" y2="716.4492"/><line style="stroke:#181818;stroke-width:1;" x1="90.9126" x2="131.9126" y1="716.4492" y2="716.4492"/><polygon fill="#181818" points="100.9126,712.4492,90.9126,716.4492,100.9126,720.4492" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="715.9458" x="96.9126" y="698.3833">k_sem_take(&amp;ble_wakeup_sem, K_MSEC(CONFIG_BT_SCAN_INTERVAL_MS - CONFIG_BT_SCAN_WINDOW_MS));</text></g><path d="M823.9458,683.25 L823.9458,723.25 L1121.9458,723.25 L1121.9458,693.25 L1111.9458,683.25 L823.9458,683.25" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M1111.9458,683.25 L1111.9458,693.25 L1121.9458,693.25 L1111.9458,683.25" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202.1729" x="829.9458" y="700.3169">Wait for the rest of the interval</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="273.0381" x="834.0781" y="715.4497">OR wake up by a saving start (sem given)</text><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="20" x2="1226.9741" y1="729.5156" y2="729.5156"/><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg20"><line style="stroke:#181818;stroke-width:1;" x1="89.9126" x2="131.9126" y1="751.6484" y2="751.6484"/><line style="stroke:#181818;stroke-width:1;" x1="131.9126" x2="131.9126" y1="751.6484" y2="764.6484"/><line style="stroke:#181818;stroke-width:1;" x1="90.9126" x2="131.9126" y1="764.6484" y2="764.6484"/><polygon fill="#181818" points="100.9126,760.6484,90.9126,764.6484,100.9126,768.6484" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104.5522" x="96.9126" y="746.5825">k_msleep(2000)</text></g><?plantuml-src lLJVQzim47xtNt7qeTYGi6vTsTQHGfgbQrcNX3WiBm6ZI9TOn9QCTVdrt--aj6cwDdHxcS3cq7rt-kuxdTn2cqhKeWH7smBvNsj9oxA8tDvJMcDbNjiIWUeb7dWg8HTYZca8hL6ICFC2euYzfAMkX24ukRxlmgqmgi1wOaPvZKATW73G7WnU0bFYb1CJtrf7xphMK6qB3an2HFeSRuOt5n_ltrzCp50eRGFaTXn5hHPqDoYNfAs1GIuSGjoli1P-GnHGM5ibq6f54LE0vXMaS0bJoWhCX5fbZlYGs5kXo0O8rG2daYZrsDinWqSRtbo5yf4Sn9qSpZyruFmpVr-IAF8dm3hNh4hijewmp8GalS8a0bwY86Yh5N8jp4q94Y1pbWvLSFjrX9cjucIFCPPOTJtFYL533Bmzhv1NcpciDULWS1sEU2lraQ8Ve_wwU0z6e_Q53cgxqQMcBIWalYA-AMZ4jFZ7Qfy8fEm0sXoFTbAOXug2-L1IiENqjPHyFGpK6rRCABlU0_P6QEZCre12vg2qavPbtkxzVd6YPlFgAj2v38SPRa8sqmLXdPM2P1uhN6c9cJOpsu13JmEaDSPF40kJFClxhCqt8GPEcT4SoC9qEPjXlSS_2dyWouxE8YjTWLZj1DcLcRofu946T0hBz_QbNF_XPhrIcEFf8h70-9IbozPiBIk_sO0VsS-qsuax_TxDtVViUfIbdNOlk-kDkiDVxNjsGXF-S8xlUj_wOtOboTU3_Z_ru1B6GbEu2vJxHyyHs5cmjU7MhFY1cHZe3y4pWMK5qoq8S6Bb9t8tep6pWpa_1-PXN0g7RxJjmzdPsTDi-KzXU5844sFiRm00?></g></svg>